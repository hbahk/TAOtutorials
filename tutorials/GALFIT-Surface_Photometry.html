
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Surface Photometry Using GALFIT &#8212; TAO Tutorials  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=3c32ad28" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/GALFIT-Surface_Photometry';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Spectroscopic Data Reduction" href="Spectroscopic_data_reduction.html" />
    <link rel="prev" title="SExtractor Photometry of MACS 0717" href="data/proj3/run_SExtractor.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">TAO Tutorials</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">SNU TAO Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Preparation.html">Preparation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Project Tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="PSF_photometry.html">PSF photometry of NGC 2210</a></li>
<li class="toctree-l1"><a class="reference internal" href="data/proj3/run_SExtractor.html">SExtractor Photometry of MACS 0717</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Surface Photometry Using GALFIT</a></li>
<li class="toctree-l1"><a class="reference internal" href="Spectroscopic_data_reduction.html">Spectroscopic Data Reduction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Additional Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Preprocessing.html">Preprocessing the CCD images</a></li>
<li class="toctree-l1"><a class="reference internal" href="SAO-Spectroscopic-Data-Reduction.html">Concept of spectroscopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="Optical%20Spectroscopy.html">Specutils: An Astropy package for spectroscopy</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/hbahk/TAOTutorials" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/tutorials/GALFIT-Surface_Photometry.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Surface Photometry Using GALFIT</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-galfit">0. Install GALFIT</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-the-input-data">1. Prepare the Input Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-sdss-mosaic-image-from-sdss-science-archive-server-sas">Download SDSS Mosaic Image from SDSS Science Archive Server (SAS)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#m51">M51</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-psf">Getting PSF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#making-the-mask-image">Making the Mask Image</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initialize-model-and-run-galfit">2. Initialize Model and Run GALFIT</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluating-the-fit">3. Evaluating the Fit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#usefull-references">Usefull References</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-galfit-run">Simple GALFIT Run</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#to-obtain-psf-from-sdss-sas">To Obtain PSF from SDSS SAS</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="surface-photometry-using-galfit">
<h1>Surface Photometry Using GALFIT<a class="headerlink" href="#surface-photometry-using-galfit" title="Link to this heading">#</a></h1>
<p>Multi-component galaxy modeling using GALFIT typically involves following steps:</p>
<ol class="arabic simple">
<li><p>Prepare the input data: The first step is to prepare the input data for GALFIT. This involves selecting the image(s) to be modeled, determining the PSF (point spread function) of the instrument, and creating a mask to exclude regions that should not be included in the model.</p></li>
<li><p>Initialize the model: The next step is to initialize the model parameters in GALFIT. This involves specifying the number and type of components to be included in the model (e.g., bulge, disk, bar, etc.), and setting the initial values of the model parameters (e.g., position, size, brightness, etc.).</p></li>
<li><p>Run the fitting process: Once the model is initialized, GALFIT can be used to fit the model to the input data. This involves minimizing the chi-squared statistic between the model and the data, using an iterative algorithm to adjust the model parameters.</p></li>
<li><p>Evaluate the fit: After the fitting process is complete, it is important to evaluate the quality of the fit. This can be done by examining the residuals (i.e., the difference between the data and the model), as well as the goodness-of-fit statistics provided by GALFIT (e.g., reduced chi-squared, Akaike Information Criterion, Bayesian Information Criterion, etc.).</p></li>
<li><p>Refine the model: Based on the evaluation of the fit, it may be necessary to refine the model by adjusting the model parameters and/or the mask. This process may need to be repeated several times until an acceptable fit is achieved.</p></li>
<li><p>Extract results: Once an acceptable fit is achieved, the final model parameters can be extracted from GALFIT and used to generate images or other data products that represent the modeled galaxy. These results can be used for further analysis and interpretation of the observed galaxy.</p></li>
</ol>
<section id="install-galfit">
<h2>0. Install GALFIT<a class="headerlink" href="#install-galfit" title="Link to this heading">#</a></h2>
<p>Before you start, you might as well need to install GALFIT. You can download the software from the <a class="reference external" href="http://users.obs.carnegiescience.edu/peng/work/galfit/galfit.html">official website</a>. Select the appropriate version for your operating system and download the executable file.</p>
</section>
<section id="prepare-the-input-data">
<h2>1. Prepare the Input Data<a class="headerlink" href="#prepare-the-input-data" title="Link to this heading">#</a></h2>
<section id="download-sdss-mosaic-image-from-sdss-science-archive-server-sas">
<h3>Download SDSS Mosaic Image from SDSS Science Archive Server (SAS)<a class="headerlink" href="#download-sdss-mosaic-image-from-sdss-science-archive-server-sas" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Web link: <a class="reference external" href="https://dr12.sdss.org/mosaics">Imaging Mosaics</a></p></li>
</ul>
<p><img alt="" src="../_images/1.png" /></p>
<p>Fill out the RA and Dec information, and resulting angluar size of the image.
Then click the “Submit” button.</p>
<p><img alt="" src="../_images/2.png" /></p>
<p>Click “Click here to download ~” to get the shell file.</p>
<p>Before you create the mosaic image you have to install <code class="docutils literal notranslate"><span class="pre">SWarp</span></code> package.</p>
<p>If you use Anaconda environment (check your current environment before the installation),</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>astromatic-swarp
</pre></div>
</div>
<div class="attention admonition">
<p class="admonition-title">For Mac Apple Silicon Users</p>
<p>If you specified your architecture as <code class="docutils literal notranslate"><span class="pre">noarch</span></code> or <code class="docutils literal notranslate"><span class="pre">osx-arm64</span></code> for new Apple Silicons, you might get an error message, since the <code class="docutils literal notranslate"><span class="pre">SWarp</span></code> package is not available for <code class="docutils literal notranslate"><span class="pre">osx-arm64</span></code> architecture yet.
In this case, you need to make a new environment and specify the architecture as <code class="docutils literal notranslate"><span class="pre">osx-64</span></code> instead.</p>
</div>
<p>Otherwise you need to install by following <a class="reference external" href="https://www.astromatic.net/software/swarp/">the official website</a> which I didn’t test.</p>
<ul class="simple">
<li><p>Useful Resources (If you want to evaluate errors pixel by pixel)</p>
<ul>
<li><p><a class="reference external" href="https://www.sdss4.org/dr16/imaging/images/">Description of SDSS Imaging Data Files</a></p></li>
<li><p><a class="reference external" href="https://data.sdss.org/datamodel/files/BOSS_PHOTOOBJ/frames/RERUN/RUN/CAMCOL/frame.html">FITS Structure for Corrected Frame</a></p></li>
</ul>
</li>
</ul>
</section>
<hr class="docutils" />
<section id="m51">
<h3>M51<a class="headerlink" href="#m51" title="Link to this heading">#</a></h3>
<p>In this tutorial, we conduct surface photometry of M51, whose image is downloaded
from the archival data of SDSS, to reproduce Figure 21. (see below figure) of <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2010AJ....139.2097P/abstract">Peng et al. (2010)</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Fitting the surface brightness profile of a spiral galaxy like M51 is a challenging task, as it typically requires a multi-component model to account for the different structural components of the galaxy (e.g., bulge, disk, spiral arms, etc.). GALFIT is a powerful tool for this purpose, but it requires careful consideration of the model parameters and fitting strategy to obtain reliable results. For spiral or irregular galaxies, it is very hard to get a result without crash. When GALFIT crashes, it prints a ascii-coded image of a nuclear explosion, which is very annoying when you encounter it over and over again. <strong>So I recommend to avoid spirals or irregulars for your first trial and class project, for your own mental health!</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
                 __/~*##$%@@@******~\-__        
               /f=r/~_-~ _-_ --_.^-~--\=b\      
             4fF / */  .o  ._-__.__/~-. \*R\    
            /fF./  . /- /&#39; /|/|  \_  * *\ *\R\  
           (iC.I+ &#39;| - *-/00  |-  \  )  ) )|RB  
           (I| (  [  / -|/^^\ |   )  /_/ | *)B  
           (I(. \ `` \   \m_m_|~__/ )_ .-~ F/   
            \b\\=_.\_b`-+-~x-_/ .. ,._/ , F/    
             ~\_\= =  =-*###%#x==-#  *=- =/     
                ~\**U/~  | i i | ~~~\===~       
                        | I I \\                
                       / // i\ \\               
                  (   [ (( I@) )))  )           
                       \_\_VYVU_/               
                         || * |                 
                        /* /I\ *~~\              
                      /~-/*  / \ \ ~~M~\         
            ____----=~ // /WVW\* \|\ ***===--___ 
 
   Doh!  GALFIT crashed because at least one of the model parameters 
   is bad.  The most common causes are: effective radius too small/big,
   component is too far outside of fitting region (also check fitting
   region), model mag too faint, axis ratio too small, Sersic index
   too small/big, Nuker powerlaw too small/big.  If frustrated or 
   problem should persist, email for help or report problem to: 
                     Chien.Y.Peng@gmail.com 

</pre></div>
</div>
</div>
<p><img alt="" src="../_images/3.png" /></p>
<p>Let’s make mosaic of M51 field, with the image size of <span class="math notranslate nohighlight">\(18'\)</span>.
The r-band images of single fields for the mosaics are queried from the above
process, with the RA=202.446521667, Dec=47.2273441667, Image Size=0.3.</p>
<p>We make the mosaic image executing the shell file.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>&lt;Move<span class="w"> </span>To<span class="w"> </span>Path<span class="w"> </span>Where<span class="w"> </span>The<span class="w"> </span>Shell<span class="w"> </span>File<span class="w"> </span>Exists&gt;
$<span class="w"> </span>chmod<span class="w"> </span><span class="m">744</span><span class="w"> </span>&lt;Your<span class="w"> </span>Shell<span class="w"> </span>File&gt;
$<span class="w"> </span>./&lt;Your<span class="w"> </span>Shell<span class="w"> </span>File&gt;
</pre></div>
</div>
<p>Here, for example,</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>data/proj4
$<span class="w"> </span>chmod<span class="w"> </span><span class="m">744</span><span class="w"> </span>J132947.00+471338.0.sh
$<span class="w"> </span>./J132947.00+471338.0.sh
</pre></div>
</div>
<p>Then you will get <code class="docutils literal notranslate"><span class="pre">J132947.00+471338.0-r.fits</span></code> and <code class="docutils literal notranslate"><span class="pre">J132947.00+471338.0-r.weight.fits</span></code>,
the r-band image and its weight image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;./data/proj4&#39;</span><span class="p">)</span>
<span class="n">cwd</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
<span class="n">cwd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PosixPath(&#39;/Users/hbahk/class/TAOtutorials/tutorials/data/proj4&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this takes a while -- about 10 minutes</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;J132947.00+471338.0&#39;</span>

<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">cwd</span><span class="o">/</span><span class="s1">&#39;input&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="p">(</span><span class="n">cwd</span><span class="o">/</span><span class="s1">&#39;input&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>

<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;chmod 744 </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.sh&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.sh&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;rm *.bz2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.wcs</span> <span class="kn">import</span> <span class="n">WCS</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">AsymmetricPercentileInterval</span><span class="p">,</span> <span class="n">AsinhStretch</span><span class="p">,</span> <span class="n">ImageNormalize</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">13</span>

<span class="n">hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">cwd</span><span class="o">/</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">-r.fits&#39;</span><span class="p">)</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">wcs</span> <span class="o">=</span> <span class="n">WCS</span><span class="p">(</span><span class="n">hdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>

<span class="n">norm</span> <span class="o">=</span> <span class="n">ImageNormalize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">AsymmetricPercentileInterval</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">99.0</span><span class="p">),</span> <span class="n">stretch</span><span class="o">=</span><span class="n">AsinhStretch</span><span class="p">())</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">wcs</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RA&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Dec&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/381e5c456158969fd2272b1239432a97c7b650668293f4a56c5c81d85d17b257.png"><img alt="../_images/381e5c456158969fd2272b1239432a97c7b650668293f4a56c5c81d85d17b257.png" class="align-center" src="../_images/381e5c456158969fd2272b1239432a97c7b650668293f4a56c5c81d85d17b257.png" style="width: 712px; height: 636px;" />
</a>
</div>
</div>
<p>The detector gain of SDSS images differ by the camera column (CAMCOL) and the
bands (u, g, r, i, z). To know the gain of the image, we need to check the
table from the bottom page of this link: <a class="reference external" href="https://data.sdss.org/datamodel/files/BOSS_PHOTOOBJ/frames/RERUN/RUN/CAMCOL/frame.html">FITS Structure for Corrected Frame</a>
For example, the gain of CAMCOL=1 CCD in r-band is 4.71.
Since the gain is not provided in the header of the corrected frames, <code class="docutils literal notranslate"><span class="pre">Swarp</span></code>
package doesn’t provide the average effective gain as usual.</p>
<p>Let’s make error images following the guideline provided in <a class="reference external" href="https://data.sdss.org/datamodel/files/BOSS_PHOTOOBJ/frames/RERUN/RUN/CAMCOL/frame.html">FITS Structure for Corrected Frame</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">frames</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cwd</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;frame*[0-9].fits&#39;</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">RegularGridInterpolator</span>

<span class="n">frame</span> <span class="o">=</span> <span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">fhdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">fhdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">sky</span> <span class="o">=</span> <span class="n">fhdu</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">allsky</span> <span class="o">=</span> <span class="n">sky</span><span class="p">[</span><span class="s1">&#39;ALLSKY&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="c1"># be careful with the order of the axes</span>
<span class="n">SX</span><span class="p">,</span> <span class="n">SY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">sky</span><span class="p">[</span><span class="s1">&#39;XINTERP&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">sky</span><span class="p">[</span><span class="s1">&#39;YINTERP&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
<span class="n">gridx</span><span class="p">,</span> <span class="n">gridy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">allsky</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">allsky</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sinterp</span> <span class="o">=</span> <span class="n">RegularGridInterpolator</span><span class="p">((</span><span class="n">gridy</span><span class="p">,</span> <span class="n">gridx</span><span class="p">),</span> <span class="n">allsky</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                                  <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">simg</span> <span class="o">=</span> <span class="n">sinterp</span><span class="p">((</span><span class="n">SY</span><span class="p">,</span> <span class="n">SX</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SX</span> <span class="c1"># x-axis corresponds to the axis=1, the columns of the image</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-4.375000e-01, -3.125000e-01, -1.875000e-01, ...,  2.551875e+02,
         2.553125e+02,  2.554375e+02],
       [-4.375000e-01, -3.125000e-01, -1.875000e-01, ...,  2.551875e+02,
         2.553125e+02,  2.554375e+02],
       [-4.375000e-01, -3.125000e-01, -1.875000e-01, ...,  2.551875e+02,
         2.553125e+02,  2.554375e+02],
       ...,
       [-4.375000e-01, -3.125000e-01, -1.875000e-01, ...,  2.551875e+02,
         2.553125e+02,  2.554375e+02],
       [-4.375000e-01, -3.125000e-01, -1.875000e-01, ...,  2.551875e+02,
         2.553125e+02,  2.554375e+02],
       [-4.375000e-01, -3.125000e-01, -1.875000e-01, ...,  2.551875e+02,
         2.553125e+02,  2.554375e+02]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>

<span class="n">inorm</span> <span class="o">=</span> <span class="n">ImageNormalize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">AsymmetricPercentileInterval</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mf">99.0</span><span class="p">),</span> <span class="n">stretch</span><span class="o">=</span><span class="n">AsinhStretch</span><span class="p">())</span>
<span class="n">snorm</span> <span class="o">=</span> <span class="n">ImageNormalize</span><span class="p">(</span><span class="n">simg</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">AsymmetricPercentileInterval</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">99.0</span><span class="p">),</span> <span class="n">stretch</span><span class="o">=</span><span class="n">AsinhStretch</span><span class="p">())</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">inorm</span><span class="p">)</span>
<span class="n">im_sky</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">simg</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">snorm</span><span class="p">)</span>

<span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="n">divider2</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;5%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">cax2</span> <span class="o">=</span> <span class="n">divider2</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;5%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;nmgy&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im_sky</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;counts&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Calibrated Image&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Reconstructed Sky Image&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Reconstructed Sky Image&#39;)
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/7816db65c48bca2003bcde8efaeb78aed66c3867c2bfccc5c12fcfe21ad1b0ec.png"><img alt="../_images/7816db65c48bca2003bcde8efaeb78aed66c3867c2bfccc5c12fcfe21ad1b0ec.png" class="align-center" src="../_images/7816db65c48bca2003bcde8efaeb78aed66c3867c2bfccc5c12fcfe21ad1b0ec.png" style="width: 681px; height: 841px;" />
</a>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">calib</span> <span class="o">=</span> <span class="n">fhdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">nrowc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">cimg</span> <span class="o">=</span> <span class="n">calib</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nrowc</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">calib</span><span class="p">)))</span>

<span class="n">inorm</span> <span class="o">=</span> <span class="n">ImageNormalize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">AsymmetricPercentileInterval</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mf">99.0</span><span class="p">),</span> <span class="n">stretch</span><span class="o">=</span><span class="n">AsinhStretch</span><span class="p">())</span>
<span class="n">cnorm</span> <span class="o">=</span> <span class="n">ImageNormalize</span><span class="p">(</span><span class="n">cimg</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">AsymmetricPercentileInterval</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">99.0</span><span class="p">),</span> <span class="n">stretch</span><span class="o">=</span><span class="n">AsinhStretch</span><span class="p">())</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">inorm</span><span class="p">)</span>
<span class="n">im_cal</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cimg</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">cnorm</span><span class="p">)</span>

<span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="n">divider2</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;5%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">cax2</span> <span class="o">=</span> <span class="n">divider2</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;5%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;nmgy&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im_cal</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax2</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Calibrated Image&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Calibration Image&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Calibration Image&#39;)
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/4e8d2c5b2f157226cbd89810242b4010a445bc52978a1a86cec2075486cecf13.png"><img alt="../_images/4e8d2c5b2f157226cbd89810242b4010a445bc52978a1a86cec2075486cecf13.png" class="align-center" src="../_images/4e8d2c5b2f157226cbd89810242b4010a445bc52978a1a86cec2075486cecf13.png" style="width: 670px; height: 841px;" />
</a>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dn</span> <span class="o">=</span> <span class="n">img</span><span class="o">/</span><span class="n">cimg</span> <span class="o">+</span> <span class="n">simg</span> <span class="c1"># count unit</span>

<span class="c1"># dictionary for gain and dark variance of r-band</span>
<span class="n">dict_gain_r</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="mf">4.71</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span><span class="mf">4.6</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span><span class="mf">4.72</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span><span class="mf">4.76</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span><span class="mf">4.725</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">:</span><span class="mf">4.895</span><span class="p">}</span>
<span class="n">dict_darkvar_r</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="mf">1.8225</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span><span class="mf">1.00</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span><span class="mf">1.3225</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span><span class="mf">1.3225</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span><span class="mf">0.81</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">:</span><span class="mf">0.9025</span><span class="p">}</span>

<span class="n">camcol</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># read camcol in the filename</span>
<span class="n">gain</span> <span class="o">=</span> <span class="n">dict_gain_r</span><span class="p">[</span><span class="n">camcol</span><span class="p">]</span>
<span class="n">darkvar</span> <span class="o">=</span> <span class="n">dict_darkvar_r</span><span class="p">[</span><span class="n">camcol</span><span class="p">]</span>

<span class="c1"># error map in count</span>
<span class="n">dn_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dn</span><span class="o">/</span><span class="n">gain</span> <span class="o">+</span> <span class="n">darkvar</span><span class="p">)</span>

<span class="n">img_err</span> <span class="o">=</span> <span class="n">dn_err</span><span class="o">*</span><span class="n">cimg</span> <span class="c1"># error map in nmgy</span>

<span class="c1"># plot flux and error map</span>
<span class="n">inorm</span> <span class="o">=</span> <span class="n">ImageNormalize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">AsymmetricPercentileInterval</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mf">99.0</span><span class="p">),</span> <span class="n">stretch</span><span class="o">=</span><span class="n">AsinhStretch</span><span class="p">())</span>
<span class="n">enorm</span> <span class="o">=</span> <span class="n">ImageNormalize</span><span class="p">(</span><span class="n">img_err</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">AsymmetricPercentileInterval</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">99.0</span><span class="p">),</span> <span class="n">stretch</span><span class="o">=</span><span class="n">AsinhStretch</span><span class="p">())</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">inorm</span><span class="p">)</span>
<span class="n">im_cal</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_err</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">enorm</span><span class="p">)</span>

<span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="n">divider2</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;5%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">cax2</span> <span class="o">=</span> <span class="n">divider2</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;5%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;nmgy&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im_cal</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;nmgy&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Calibrated Image&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Calibration Error Image&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Calibration Error Image&#39;)
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/1de36e7bd2a72a03e156276dc8cb1e084b061f30801bea73fc4b4a3f51104149.png"><img alt="../_images/1de36e7bd2a72a03e156276dc8cb1e084b061f30801bea73fc4b4a3f51104149.png" class="align-center" src="../_images/1de36e7bd2a72a03e156276dc8cb1e084b061f30801bea73fc4b4a3f51104149.png" style="width: 670px; height: 841px;" />
</a>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_sdss_r_errimg</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
    <span class="n">fhdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="n">hdr</span> <span class="o">=</span> <span class="n">fhdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">fhdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    
    <span class="c1"># sky reconstruction</span>
    <span class="n">sky</span> <span class="o">=</span> <span class="n">fhdu</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">allsky</span> <span class="o">=</span> <span class="n">sky</span><span class="p">[</span><span class="s1">&#39;ALLSKY&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">SX</span><span class="p">,</span> <span class="n">SY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">sky</span><span class="p">[</span><span class="s1">&#39;XINTERP&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">sky</span><span class="p">[</span><span class="s1">&#39;YINTERP&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
    <span class="n">gridx</span><span class="p">,</span> <span class="n">gridy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">allsky</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">allsky</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">sinterp</span> <span class="o">=</span> <span class="n">RegularGridInterpolator</span><span class="p">((</span><span class="n">gridy</span><span class="p">,</span> <span class="n">gridx</span><span class="p">),</span> <span class="n">allsky</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                                    <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">simg</span> <span class="o">=</span> <span class="n">sinterp</span><span class="p">((</span><span class="n">SY</span><span class="p">,</span> <span class="n">SX</span><span class="p">))</span>
    
    <span class="c1"># calibration image</span>
    <span class="n">calib</span> <span class="o">=</span> <span class="n">fhdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">nrowc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">cimg</span> <span class="o">=</span> <span class="n">calib</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nrowc</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">calib</span><span class="p">)))</span>
    
    <span class="n">dn</span> <span class="o">=</span> <span class="n">img</span><span class="o">/</span><span class="n">cimg</span> <span class="o">+</span> <span class="n">simg</span> <span class="c1"># count unit</span>

    <span class="c1"># dictionary for gain and dark variance of r-band</span>
    <span class="c1"># https://data.sdss.org/datamodel/files/BOSS_PHOTOOBJ/frames/RERUN/RUN/CAMCOL/frame.html</span>
    <span class="n">dict_gain_r</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="mf">4.71</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span><span class="mf">4.6</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span><span class="mf">4.72</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span><span class="mf">4.76</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span><span class="mf">4.725</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">:</span><span class="mf">4.895</span><span class="p">}</span>
    <span class="n">dict_darkvar_r</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="mf">1.8225</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span><span class="mf">1.00</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span><span class="mf">1.3225</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span><span class="mf">1.3225</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span><span class="mf">0.81</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">:</span><span class="mf">0.9025</span><span class="p">}</span>

    <span class="n">camcol</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># read camcol in the filename</span>
    <span class="n">gain</span> <span class="o">=</span> <span class="n">dict_gain_r</span><span class="p">[</span><span class="n">camcol</span><span class="p">]</span>
    <span class="n">darkvar</span> <span class="o">=</span> <span class="n">dict_darkvar_r</span><span class="p">[</span><span class="n">camcol</span><span class="p">]</span>

    <span class="c1"># error map in count</span>
    <span class="n">dn_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dn</span><span class="o">/</span><span class="n">gain</span> <span class="o">+</span> <span class="n">darkvar</span><span class="p">)</span>

    <span class="n">img_err</span> <span class="o">=</span> <span class="n">dn_err</span><span class="o">*</span><span class="n">cimg</span> <span class="c1"># error map in nmgy</span>
    
    <span class="k">return</span> <span class="n">img_err</span><span class="p">,</span> <span class="n">hdr</span>

<span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
    <span class="n">eimg</span><span class="p">,</span> <span class="n">hdr</span> <span class="o">=</span> <span class="n">get_sdss_r_errimg</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="c1"># save error image</span>
    <span class="n">ivhdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">eimg</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">hdr</span><span class="p">)</span>
    <span class="n">ivhdu</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">stem</span><span class="o">+</span><span class="s1">&#39;.ivar.fits&#39;</span><span class="p">),</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add gain to header</span>
<span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
    <span class="n">fhdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="n">dict_gain_r</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="mf">4.71</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span><span class="mf">4.6</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span><span class="mf">4.72</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span><span class="mf">4.76</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span><span class="mf">4.725</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">:</span><span class="mf">4.895</span><span class="p">}</span>
    <span class="n">dict_darkvar_r</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="mf">1.8225</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span><span class="mf">1.00</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span><span class="mf">1.3225</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span><span class="mf">1.3225</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span><span class="mf">0.81</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">:</span><span class="mf">0.9025</span><span class="p">}</span>

    <span class="n">camcol</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># read camcol in the filename</span>
    <span class="n">gain</span> <span class="o">=</span> <span class="n">dict_gain_r</span><span class="p">[</span><span class="n">camcol</span><span class="p">]</span>
    <span class="n">fhdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;GAIN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gain</span>
    
    <span class="n">fhdu</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># mosaic images again and make a mosaic of the ivar images</span>
<span class="n">str_eframes</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.ivar.fits\[0\]&#39;</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">])</span>
<span class="n">str_frames</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.fits&#39;</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">])</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;swarp &#39;</span><span class="o">+</span><span class="n">str_frames</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;swarp &#39;</span><span class="o">+</span><span class="n">str_eframes</span><span class="o">+</span><span class="sa">f</span><span class="s1">&#39; -IMAGEOUT_NAME </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">-r.ivar.fits -WEIGHTOUT_NAME </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">-r.err.weight.fits&#39;</span><span class="p">)</span>
<span class="c1"># &#39;swarp &#39;+str_frames+&#39; -c default.swarp -WEIGHT_TYPE MAP_RMS -WEIGHT_SUFFIX .err.fits\[0\] -RESCALE_WEIGHTS N&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get sigma image from ivar image</span>
<span class="n">DIR_INPUT</span> <span class="o">=</span> <span class="s1">&#39;input&#39;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">cwd</span><span class="o">/</span><span class="n">DIR_INPUT</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="p">(</span><span class="n">cwd</span><span class="o">/</span><span class="n">DIR_INPUT</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>

<span class="n">ivhdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">-r.ivar.fits&#39;</span><span class="p">)</span>
<span class="n">ivimg</span> <span class="o">=</span> <span class="n">ivhdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">eimg</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ivimg</span><span class="p">)</span>
<span class="n">ehdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">eimg</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">ivhdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
<span class="n">ehdu</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">cwd</span><span class="o">/</span><span class="n">DIR_INPUT</span><span class="o">/</span><span class="sa">f</span><span class="s1">&#39;sigma_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">-r.fits&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># galfit takes nmagy as count and devide the exposure time to calculate the magnitude</span>
<span class="n">hdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;EXPTIME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">hdu</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">cwd</span><span class="o">/</span><span class="n">DIR_INPUT</span><span class="o">/</span><span class="sa">f</span><span class="s1">&#39;input_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">-r.fits&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="getting-psf">
<h3>Getting PSF<a class="headerlink" href="#getting-psf" title="Link to this heading">#</a></h3>
<p>Since we need PSF to use GALFIT, we will get PSF of the image using the PSFEx software. If you want more
information about PSFEx, please check this link: <a class="reference external" href="https://psfex.readthedocs.io/en/latest/GettingStarted.html">PSFEx: Getting Started</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Aperture size for SExtractor run</span>
<span class="n">FACTOR</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">PHOT_APERTURE</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">FACTOR</span> <span class="c1"># in arcsec</span>
<span class="n">SCALE</span> <span class="o">=</span> <span class="mf">0.396127</span><span class="o">*</span><span class="n">FACTOR</span> <span class="c1"># arcsec/pixel</span>
<span class="n">PHOT_APERTURE_PIX</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">PHOT_APERTURE</span><span class="o">/</span><span class="n">SCALE</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">SCALE</span><span class="p">,</span> <span class="n">PHOT_APERTURE_PIX</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.396127 25
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SExtractor parameter file setting</span>
<span class="n">param_name</span> <span class="o">=</span> <span class="s2">&quot;output.param&quot;</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;X_IMAGE</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>         <span class="c1"># Object position along x [pixel]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Y_IMAGE</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>         <span class="c1"># Object position along y [pixel]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;VIGNET(</span><span class="si">{</span><span class="n">PHOT_APERTURE_PIX</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">PHOT_APERTURE_PIX</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Pixel data around detection [count]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FLUX_RADIUS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>     <span class="c1"># Half-light radii</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SNR_WIN</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>         <span class="c1"># Gaussian-weighted SNR</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FLUX_APER(1)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>    <span class="c1"># Flux vector within fixed circular aperture(s) [count]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FLUXERR_APER(1)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># RMS error vector for aperture flux(es) [count]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ELONGATION</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>      <span class="c1"># A_IMAGE/B_IMAGE</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FLAGS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>           <span class="c1"># Extraction flags</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_scroll-output tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SExtractor run to feed PSFEx</span>
<span class="n">PATH_CONV</span> <span class="o">=</span> <span class="s2">&quot;/opt/homebrew/opt/sextractor/share/sextractor/default.conv&quot;</span>
<span class="n">PATH_NNW</span> <span class="o">=</span> <span class="s2">&quot;/opt/homebrew/opt/sextractor/share/sextractor/default.nnw&quot;</span>
<span class="n">SEXTRACTOR_COMMAND</span> <span class="o">=</span> <span class="s2">&quot;sex&quot;</span>

<span class="n">catalog_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">-r.cat&quot;</span>

<span class="n">exec_sextractor</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">SEXTRACTOR_COMMAND</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">-r.fits -c default.sex&quot;</span>
    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; -CATALOG_NAME </span><span class="si">{</span><span class="n">catalog_name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; -PARAMETERS_NAME </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; -FILTER_NAME </span><span class="si">{</span><span class="n">PATH_CONV</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; -CATALOG_TYPE FITS_LDAC -PHOT_APERTURES </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">PHOT_APERTURE</span><span class="o">/</span><span class="n">SCALE</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>

<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;sex -d &gt;&gt; default.sex&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">exec_sextractor</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&gt; 
----- SExtractor 2.28.0 started on 2024-05-11 at 18:00:36 with 1 thread

&gt; Setting catalog parameters
&gt; Reading detection filter
&gt; Initializing catalog
&gt; Looking for J132947.00+471338.0-r.fits
----- Measuring from: J132947.00+471338.0-r.fits
      &quot;30 N&quot; / no ext. header / 2726x2726 / 32 bits (floats)
Detection+Measurement image: &gt; Setting up background maps
&gt; Setting up background map at line:   64
&gt; Setting up background map at line:  128
&gt; Setting up background map at line:  192
&gt; Setting up background map at line:  256
&gt; Setting up background map at line:  320
&gt; Setting up background map at line:  384
&gt; Setting up background map at line:  448
&gt; Setting up background map at line:  512
&gt; Setting up background map at line:  576
&gt; Setting up background map at line:  640
&gt; Setting up background map at line:  704
&gt; Setting up background map at line:  768
&gt; Setting up background map at line:  832
&gt; Setting up background map at line:  896
&gt; Setting up background map at line:  960
&gt; Setting up background map at line: 1024
&gt; Setting up background map at line: 1088
&gt; Setting up background map at line: 1152
&gt; Setting up background map at line: 1216
&gt; Setting up background map at line: 1280
&gt; Setting up background map at line: 1344
&gt; Setting up background map at line: 1408
&gt; Setting up background map at line: 1472
&gt; Setting up background map at line: 1536
&gt; Setting up background map at line: 1600
&gt; Setting up background map at line: 1664
&gt; Setting up background map at line: 1728
&gt; Setting up background map at line: 1792
&gt; Setting up background map at line: 1856
&gt; Setting up background map at line: 1920
&gt; Setting up background map at line: 1984
&gt; Setting up background map at line: 2048
&gt; Setting up background map at line: 2112
&gt; Setting up background map at line: 2176
&gt; Setting up background map at line: 2240
&gt; Setting up background map at line: 2304
&gt; Setting up background map at line: 2368
&gt; Setting up background map at line: 2432
&gt; Setting up background map at line: 2496
&gt; Setting up background map at line: 2560
&gt; Setting up background map at line: 2624
&gt; Setting up background map at line: 2688
&gt; Filtering background map(s)
&gt; Computing background d-map
&gt; Computing background-noise d-map
(M+D) Background: 0.00834126 RMS: 0.0226906  / Threshold: 0.0340358  
&gt; Scanning image
&gt; Line:   25  Objects:        9 detected /        0 sextracted
&gt; Line:   50  Objects:       19 detected /        0 sextracted
&gt; Line:   75  Objects:       29 detected /        0 sextracted
&gt; Line:  100  Objects:       46 detected /        0 sextracted
&gt; Line:  125  Objects:       60 detected /        0 sextracted
&gt; Line:  150  Objects:       69 detected /        0 sextracted
&gt; Line:  175  Objects:       80 detected /        0 sextracted
&gt; Line:  200  Objects:       98 detected /        0 sextracted
&gt; Line:  225  Objects:      118 detected /        0 sextracted
&gt; Line:  250  Objects:      138 detected /        0 sextracted
&gt; Line:  275  Objects:      154 detected /        0 sextracted
&gt; Line:  300  Objects:      167 detected /        0 sextracted
&gt; Line:  325  Objects:      205 detected /        0 sextracted
&gt; Line:  350  Objects:      252 detected /        0 sextracted
&gt; Line:  375  Objects:      282 detected /        0 sextracted
&gt; Line:  400  Objects:      312 detected /        0 sextracted
&gt; Line:  425  Objects:      347 detected /        0 sextracted
&gt; Line:  450  Objects:      395 detected /        0 sextracted
&gt; Line:  475  Objects:      442 detected /        0 sextracted
&gt; Line:  500  Objects:      482 detected /        0 sextracted
&gt; Line:  525  Objects:      518 detected /        0 sextracted
&gt; Line:  550  Objects:      558 detected /        0 sextracted
&gt; Line:  575  Objects:      605 detected /        0 sextracted
&gt; Line:  600  Objects:      681 detected /        0 sextracted
&gt; Line:  625  Objects:      750 detected /        0 sextracted
&gt; Line:  650  Objects:      800 detected /        0 sextracted
&gt; Line:  675  Objects:      829 detected /        0 sextracted
&gt; Line:  700  Objects:      870 detected /        0 sextracted
&gt; Line:  725  Objects:      909 detected /        0 sextracted
&gt; Line:  750  Objects:      938 detected /        0 sextracted
&gt; Line:  775  Objects:      968 detected /        0 sextracted
&gt; Line:  800  Objects:      995 detected /        0 sextracted
&gt; Line:  825  Objects:     1050 detected /        0 sextracted
&gt; Line:  850  Objects:     1095 detected /        0 sextracted
&gt; Line:  875  Objects:     1140 detected /        0 sextracted
&gt; Line:  900  Objects:     1184 detected /        0 sextracted
&gt; Line:  925  Objects:     1237 detected /        0 sextracted
&gt; Line:  950  Objects:     1277 detected /        0 sextracted
&gt; Line:  975  Objects:     1327 detected /        0 sextracted
&gt; Line: 1000  Objects:     1370 detected /        0 sextracted
&gt; Line: 1022  Objects:     1408 detected /        0 sextracted
&gt; Line: 1025  Objects:     1418 detected /       15 sextracted
&gt; Line: 1050  Objects:     1454 detected /       25 sextracted
&gt; Line: 1075  Objects:     1501 detected /       34 sextracted
&gt; Line: 1100  Objects:     1530 detected /       48 sextracted
&gt; Line: 1125  Objects:     1556 detected /       60 sextracted
&gt; Line: 1150  Objects:     1585 detected /       73 sextracted
&gt; Line: 1175  Objects:     1620 detected /       81 sextracted
&gt; Line: 1200  Objects:     1672 detected /      101 sextracted
&gt; Line: 1225  Objects:     1707 detected /      115 sextracted
&gt; Line: 1250  Objects:     1755 detected /      133 sextracted
&gt; Line: 1275  Objects:     1795 detected /      155 sextracted
&gt; Line: 1300  Objects:     1837 detected /      172 sextracted
&gt; Line: 1325  Objects:     1874 detected /      195 sextracted
&gt; Line: 1350  Objects:     1912 detected /      224 sextracted
&gt; Line: 1375  Objects:     1944 detected /      245 sextracted
&gt; Line: 1400  Objects:     1980 detected /      273 sextracted
&gt; Line: 1425  Objects:     2024 detected /      309 sextracted
&gt; Line: 1450  Objects:     2066 detected /      342 sextracted
&gt; Line: 1475  Objects:     2125 detected /      363 sextracted
&gt; Line: 1500  Objects:     2193 detected /      391 sextracted
&gt; Line: 1510  Objects:     2215 detected /      400 sextracted
&gt; Line: 1525  Objects:     2234 detected /      422 sextracted
&gt; Line: 1550  Objects:     2281 detected /      454 sextracted
&gt; Line: 1575  Objects:     2327 detected /      487 sextracted
&gt; Line: 1600  Objects:     2364 detected /      522 sextracted
&gt; Line: 1625  Objects:     2394 detected /      546 sextracted
&gt; Line: 1650  Objects:     2429 detected /      579 sextracted
&gt; Line: 1675  Objects:     2465 detected /      599 sextracted
&gt; Line: 1700  Objects:     2493 detected /      629 sextracted
&gt; Line: 1725  Objects:     2544 detected /      651 sextracted
&gt; Line: 1750  Objects:     2579 detected /      666 sextracted
&gt; Line: 1775  Objects:     2614 detected /      681 sextracted
&gt; Line: 1800  Objects:     2647 detected /      698 sextracted
&gt; Line: 1825  Objects:     2707 detected /      726 sextracted
&gt; Line: 1850  Objects:     2781 detected /      746 sextracted
&gt; Line: 1875  Objects:     2835 detected /      770 sextracted
&gt; Line: 1900  Objects:     2888 detected /      791 sextracted
&gt; Line: 1910  Objects:     2911 detected /      800 sextracted
&gt; Line: 1925  Objects:     2937 detected /      818 sextracted
&gt; Line: 1950  Objects:     2994 detected /      830 sextracted
&gt; Line: 1975  Objects:     3055 detected /      857 sextracted
&gt; Line: 2000  Objects:     3122 detected /      873 sextracted
&gt; Line: 2025  Objects:     3170 detected /      900 sextracted
&gt; Line: 2050  Objects:     3229 detected /      922 sextracted
&gt; Line: 2075  Objects:     3284 detected /      938 sextracted
&gt; Line: 2100  Objects:     3342 detected /      954 sextracted
&gt; Line: 2125  Objects:     3390 detected /      971 sextracted
&gt; Line: 2150  Objects:     3422 detected /      991 sextracted
&gt; Line: 2175  Objects:     3453 detected /     1010 sextracted
&gt; Line: 2200  Objects:     3472 detected /     1026 sextracted
&gt; Line: 2225  Objects:     3490 detected /     1043 sextracted
&gt; Line: 2250  Objects:     3509 detected /     1069 sextracted
&gt; Line: 2275  Objects:     3523 detected /     1094 sextracted
&gt; Line: 2300  Objects:     3542 detected /     1120 sextracted
&gt; Line: 2325  Objects:     3558 detected /     1143 sextracted
&gt; Line: 2350  Objects:     3571 detected /     1166 sextracted
&gt; Line: 2375  Objects:     3591 detected /     1181 sextracted
&gt; Line: 2393  Objects:     3604 detected /     1200 sextracted
&gt; Line: 2400  Objects:     3609 detected /     1208 sextracted
&gt; Line: 2425  Objects:     3624 detected /     1238 sextracted
&gt; Line: 2450  Objects:     3644 detected /     1263 sextracted
&gt; Line: 2475  Objects:     3664 detected /     1298 sextracted
&gt; Line: 2500  Objects:     3674 detected /     1334 sextracted
&gt; Line: 2525  Objects:     3686 detected /     1350 sextracted
&gt; Line: 2550  Objects:     3702 detected /     1369 sextracted
&gt; Line: 2575  Objects:     3727 detected /     1392 sextracted
&gt; Line: 2600  Objects:     3735 detected /     1411 sextracted
&gt; Line: 2625  Objects:     3756 detected /     1423 sextracted
&gt; Line: 2650  Objects:     3767 detected /     1443 sextracted
&gt; Line: 2675  Objects:     3778 detected /     1465 sextracted
&gt; Line: 2700  Objects:     3797 detected /     1477 sextracted
&gt; Line: 2725  Objects:     3813 detected /     1494 sextracted
&gt; Line: 2726  Objects:     3816 detected /     1600 sextracted
&gt; Line: 2726  Objects:     3816 detected /     2000 sextracted
      Objects: detected 3816     / sextracted 2262            

&gt; Closing files
&gt; 
&gt; All done (in 2.1 s: 1279.5 lines/s , 1061.7 detections/s)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_scroll-output tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># PSFEx run</span>
<span class="n">config_psfex</span> <span class="o">=</span> <span class="s1">&#39;config.psfex&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;psfex -d &gt;&gt; </span><span class="si">{</span><span class="n">config_psfex</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;psfex </span><span class="si">{</span><span class="n">catalog_name</span><span class="si">}</span><span class="s1"> -c </span><span class="si">{</span><span class="n">config_psfex</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&gt; WARNING: This executable has been compiled using a version of the ATLAS library without support for multithreading. Performance will be degraded.

&gt; 
----- PSFEx 3.24.2 started on 2024-05-11 at 18:00:38 with 8 threads

&gt; 
----- 1 input catalogues:
J132947.00+471338.0-:  &quot;30 N            &quot;    1 extension    2262 detections

&gt; Initializing contexts...
&gt; Computing optimum PSF sampling steps...
&gt; Reading data from J132947.00+471338.0-r...
&gt; Computing final PSF model for J132947.00+471338.0-r...
   filename      [ext] accepted/total samp. chi2/dof FWHM ellip. resi. asym.
&gt; Computing diagnostics for J132947.00+471338.0-r...
J132947.00+471338           82/104     0.83   0.87   3.22  0.01  0.02  0.04
&gt; Saving CHECK-image #1...
&gt; Saving CHECK-image #2...
&gt; Saving CHECK-image #3...
&gt; Saving CHECK-image #4...
&gt; Saving CHECK-image #5...
&gt; Saving PSF model and metadata for J132947.00+471338.0-r...
&gt; Writing XML file...
&gt; 
&gt; All done (in 0.0 s)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</details>
</div>
<p>We obtained <code class="docutils literal notranslate"><span class="pre">J132947.00+471338.0-r.psf</span></code>!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">phdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">-r.psf&#39;</span><span class="p">)</span>
<span class="n">fwhm</span> <span class="o">=</span> <span class="n">phdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;PSF_FWHM&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PSF_FWHM:&#39;</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">)</span>
<span class="n">phdu</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">phdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PSF_FWHM: 3.88474584
Filename: J132947.00+471338.0-r.psf
No.    Name      Ver    Type      Cards   Dimensions   Format
  0  PRIMARY       1 PrimaryHDU       4   ()      
  1  PSF_DATA      1 BinTableHDU     32   1R x 1C   [3750E]   
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>XTENSION= &#39;BINTABLE&#39;           / THIS IS A BINARY TABLE (FROM THE LDACTOOLS)    
BITPIX  =                    8 /                                                
NAXIS   =                    2 /                                                
NAXIS1  =                15000 / BYTES PER ROW                                  
NAXIS2  =                    1 / NUMBER OF ROWS                                 
PCOUNT  =                    0 / RANDOM PARAMETER COUNT                         
GCOUNT  =                    1 / GROUP COUNT                                    
TFIELDS =                    1 / FIELDS PER ROWS                                
EXTNAME = &#39;PSF_DATA&#39;           / TABLE NAME                                     
LOADED  =                  104 / Number of loaded sources                       
ACCEPTED=                   82 / Number of accepted sources                     
CHI2    =           0.87119488 / Final reduced chi2                             
POLNAXIS=                    2 / Number of context parameters                   
POLGRP1 =                    1 / Polynom group for this context parameter       
POLNAME1= &#39;X_IMAGE &#39;           / Name of this context parameter                 
POLZERO1=   1.363870513320E+03 / Offset value for this context parameter        
POLSCAL1=   2.722719910860E+03 / Scale value for this context parameter         
POLGRP2 =                    1 / Polynom group for this context parameter       
POLNAME2= &#39;Y_IMAGE &#39;           / Name of this context parameter                 
POLZERO2=   1.364084029078E+03 / Offset value for this context parameter        
POLSCAL2=   2.722851961374E+03 / Scale value for this context parameter         
POLNGRP =                    1 / Number of context groups                       
POLDEG1 =                    2 / Polynom degree for this context group          
PSF_FWHM=           3.88474584 / PSF FWHM in image pixels                       
PSF_SAMP=           0.82654166 / Sampling step of the PSF data in image pixels  
PSFNAXIS=                    3 / Dimensionality of the PSF data                 
PSFAXIS1=                   25 / Number of element along this axis              
PSFAXIS2=                   25 / Number of element along this axis              
PSFAXIS3=                    6 / Number of element along this axis              
TTYPE1  = &#39;PSF_MASK&#39;           / Tabulated PSF data                             
TFORM1  = &#39;3750E   &#39;                                                            
TDIM1   = &#39;(25, 25, 6)&#39;                                                         
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Inspect the PSF image (at the center of the image)</span>
<span class="n">image_psf</span> <span class="o">=</span> <span class="n">phdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;PSF_MASK&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">norm_psf</span> <span class="o">=</span> <span class="n">ImageNormalize</span><span class="p">(</span><span class="n">image_psf</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">AsymmetricPercentileInterval</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">99.0</span><span class="p">),</span> <span class="n">stretch</span><span class="o">=</span><span class="n">AsinhStretch</span><span class="p">())</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">pim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_psf</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm_psf</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pim</span><span class="p">)</span>

<span class="c1"># Save the PSF image</span>
<span class="n">hdu_psf</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">image_psf</span><span class="p">)</span>
<span class="n">hdu_psf</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">cwd</span><span class="o">/</span><span class="n">DIR_INPUT</span><span class="o">/</span><span class="sa">f</span><span class="s1">&#39;psf_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">-r.fits&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/bd7c59489a460b545bcc9c7d3cd6fcae98c735b71278e718e356923140f202c4.png"><img alt="../_images/bd7c59489a460b545bcc9c7d3cd6fcae98c735b71278e718e356923140f202c4.png" class="align-center" src="../_images/bd7c59489a460b545bcc9c7d3cd6fcae98c735b71278e718e356923140f202c4.png" style="width: 451px; height: 415px;" />
</a>
</div>
</div>
</section>
<section id="making-the-mask-image">
<h3>Making the Mask Image<a class="headerlink" href="#making-the-mask-image" title="Link to this heading">#</a></h3>
<p>Let’s obtain the celestial coordinates (RA and DEC) of two objects, M51A and M51B, from the NASA/IPAC Extragalactic Database (NED). From this positions, we will
determine the center coordinate pixels for each galaxy, and construct models
individually.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astroquery.ipac.ned</span> <span class="kn">import</span> <span class="n">Ned</span>
<span class="n">ra_a</span><span class="p">,</span> <span class="n">dec_a</span> <span class="o">=</span> <span class="n">Ned</span><span class="o">.</span><span class="n">query_object</span><span class="p">(</span><span class="s2">&quot;M51A&quot;</span><span class="p">)[</span><span class="s1">&#39;RA&#39;</span><span class="p">,</span> <span class="s1">&#39;DEC&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ra_b</span><span class="p">,</span> <span class="n">dec_b</span> <span class="o">=</span> <span class="n">Ned</span><span class="o">.</span><span class="n">query_object</span><span class="p">(</span><span class="s2">&quot;M51B&quot;</span><span class="p">)[</span><span class="s1">&#39;RA&#39;</span><span class="p">,</span> <span class="s1">&#39;DEC&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">x_a</span><span class="p">,</span> <span class="n">y_a</span> <span class="o">=</span> <span class="n">wcs</span><span class="o">.</span><span class="n">all_world2pix</span><span class="p">(</span><span class="n">ra_a</span><span class="p">,</span> <span class="n">dec_a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">x_b</span><span class="p">,</span> <span class="n">y_b</span> <span class="o">=</span> <span class="n">wcs</span><span class="o">.</span><span class="n">all_world2pix</span><span class="p">(</span><span class="n">ra_b</span><span class="p">,</span> <span class="n">dec_b</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">wcs</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RA&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Dec&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_a</span><span class="p">,</span> <span class="n">y_a</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_b</span><span class="p">,</span> <span class="n">y_b</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x7faa52057490&gt;
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/71fdfdb6a81d5091a86741a9a78925f7f857befef4b4af2cc890cdadc5b0f89a.png"><img alt="../_images/71fdfdb6a81d5091a86741a9a78925f7f857befef4b4af2cc890cdadc5b0f89a.png" class="align-center" src="../_images/71fdfdb6a81d5091a86741a9a78925f7f857befef4b4af2cc890cdadc5b0f89a.png" style="width: 712px; height: 636px;" />
</a>
</div>
</div>
<p>Two red and blue circular markers are plotted on the image at the pixel coordinates of M51A and M51B, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">photutils.segmentation</span> <span class="kn">import</span> <span class="n">detect_sources</span>
<span class="kn">from</span> <span class="nn">photutils.background</span> <span class="kn">import</span> <span class="n">Background2D</span><span class="p">,</span> <span class="n">MedianBackground</span>
<span class="kn">from</span> <span class="nn">astropy.convolution</span> <span class="kn">import</span> <span class="n">convolve</span>
<span class="kn">from</span> <span class="nn">photutils.segmentation</span> <span class="kn">import</span> <span class="n">make_2dgaussian_kernel</span>
<span class="c1"># from photutils.detection import DAOStarFinder</span>

<span class="n">bkg_estimator</span> <span class="o">=</span> <span class="n">MedianBackground</span><span class="p">()</span>
<span class="n">bkg</span> <span class="o">=</span> <span class="n">Background2D</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">filter_size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">bkg_estimator</span><span class="o">=</span><span class="n">bkg_estimator</span><span class="p">)</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">bkg</span><span class="o">.</span><span class="n">background_rms</span>

<span class="n">kernel</span> <span class="o">=</span> <span class="n">make_2dgaussian_kernel</span><span class="p">(</span><span class="n">fwhm</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">convolved_data</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>

<span class="n">segment_map</span> <span class="o">=</span> <span class="n">detect_sources</span><span class="p">(</span><span class="n">convolved_data</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">npixels</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">segment_map</span><span class="p">)</span>

<span class="n">label_main</span> <span class="o">=</span> <span class="n">segment_map</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">y_a</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_a</span><span class="p">)]</span>
<span class="n">orig_seg</span> <span class="o">=</span> <span class="n">segment_map</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">segment_map</span><span class="o">.</span><span class="n">remove_labels</span><span class="p">([</span><span class="n">label_main</span><span class="p">])</span>

<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">segment_map</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">masked_image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">masked_image</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    
<span class="n">mask_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="n">mask_image</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># # additional masking</span>
<span class="c1"># daofind = DAOStarFinder(fwhm=fwhm, threshold=np.median(threshold))</span>
<span class="c1"># stars = daofind(masked_image, mask=orig_seg.data.astype(bool))</span>

<span class="c1"># hw = 2</span>
<span class="c1"># for star in stars:</span>
<span class="c1">#     x, y = int(star[&#39;xcentroid&#39;]), int(star[&#39;ycentroid&#39;])</span>
<span class="c1">#     mask_image[y-hw:y+hw+1, x-hw:x+hw+1] = 0</span>
<span class="c1">#     masked_image[y-hw:y+hw+1, x-hw:x+hw+1] = -1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;photutils.segmentation.core.SegmentationImage&gt;
shape: (2726, 2726)
nlabels: 647
labels: [  1   2   3   4   5 ... 643 644 645 646 647]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">wcs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">masked_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RA&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Dec&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/b61bf9d502c3b4775e8b22029bc63efcc95f637f6fe8eafa6e03f28b0fc4948d.png"><img alt="../_images/b61bf9d502c3b4775e8b22029bc63efcc95f637f6fe8eafa6e03f28b0fc4948d.png" class="align-center" src="../_images/b61bf9d502c3b4775e8b22029bc63efcc95f637f6fe8eafa6e03f28b0fc4948d.png" style="width: 732px; height: 690px;" />
</a>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save the mask image</span>
<span class="n">hdu_mask</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">mask_image</span><span class="p">)</span>
<span class="n">hdu_mask</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">cwd</span><span class="o">/</span><span class="n">DIR_INPUT</span><span class="o">/</span><span class="sa">f</span><span class="s1">&#39;mask_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">-r.fits&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="initialize-model-and-run-galfit">
<h2>2. Initialize Model and Run GALFIT<a class="headerlink" href="#initialize-model-and-run-galfit" title="Link to this heading">#</a></h2>
<p>All the information you need is contained in <a class="reference external" href="https://users.obs.carnegiescience.edu/peng/work/galfit/README.pdf">GALFIT User Manual</a>(see Section 7 and 8)!</p>
<p>Now Let’s construct the input file. Below is an example input file (<a class="reference external" href="https://users.obs.carnegiescience.edu/peng/work/galfit/example2">you can find it from here</a>), which includes
all possible funtional type and basic information about them.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">================================================================================</span>
<span class="c1"># IMAGE and GALFIT CONTROL PARAMETERS</span>
<span class="n">A</span><span class="p">)</span> <span class="n">gal</span><span class="o">.</span><span class="n">fits</span>            <span class="c1"># Input data image (FITS file)</span>
<span class="n">B</span><span class="p">)</span> <span class="n">imgblock</span><span class="o">.</span><span class="n">fits</span>       <span class="c1"># Output data image block</span>
<span class="n">C</span><span class="p">)</span> <span class="n">none</span>                <span class="c1"># Sigma image name (made from data if blank or &quot;none&quot;) </span>
<span class="n">D</span><span class="p">)</span> <span class="n">psf</span><span class="o">.</span><span class="n">fits</span>   <span class="c1">#        # Input PSF image and (optional) diffusion kernel</span>
<span class="n">E</span><span class="p">)</span> <span class="mi">1</span>                   <span class="c1"># PSF fine sampling factor relative to data </span>
<span class="n">F</span><span class="p">)</span> <span class="n">none</span>                <span class="c1"># Bad pixel mask (FITS image or ASCII coord list)</span>
<span class="n">G</span><span class="p">)</span> <span class="n">none</span>                <span class="c1"># File with parameter constraints (ASCII file) </span>
<span class="n">H</span><span class="p">)</span> <span class="mi">1</span>    <span class="mi">93</span>   <span class="mi">1</span>    <span class="mi">93</span>   <span class="c1"># Image region to fit (xmin xmax ymin ymax)</span>
<span class="n">I</span><span class="p">)</span> <span class="mi">100</span>    <span class="mi">100</span>          <span class="c1"># Size of the convolution box (x y)</span>
<span class="n">J</span><span class="p">)</span> <span class="mf">26.563</span>              <span class="c1"># Magnitude photometric zeropoint </span>
<span class="n">K</span><span class="p">)</span> <span class="mf">0.038</span>  <span class="mf">0.038</span>        <span class="c1"># Plate scale (dx dy)   [arcsec per pixel]</span>
<span class="n">O</span><span class="p">)</span> <span class="n">regular</span>             <span class="c1"># Display type (regular, curses, both)</span>
<span class="n">P</span><span class="p">)</span> <span class="mi">0</span>                   <span class="c1"># Options: 0=normal run; 1,2=make model/imgblock &amp; quit</span>


<span class="c1"># THE OBJECT LIST BELOW can be however long or short as the complexity</span>
<span class="c1"># requires.  The user has complete freedom to mix and match the components</span>
<span class="c1"># by duplicating each object block.</span>

<span class="c1"># INITIAL FITTING PARAMETERS</span>
<span class="c1">#</span>
<span class="c1"># column 1:  Parameter number</span>
<span class="c1"># column 2: </span>
<span class="c1">#          -- Parameter 0: the allowed functions are: sersic, nuker, expdisk</span>
<span class="c1">#	      edgedisk, devauc, king, moffat, gaussian, ferrer, psf, sky</span>
<span class="c1">#	   -- Parameter 1-10: value of the initial parameters</span>
<span class="c1">#          -- Parameter C0: For diskiness/boxiness</span>
<span class="c1">#             &lt;0 = disky</span>
<span class="c1">#             &gt;0 = boxy</span>
<span class="c1">#          -- Parameter Z: Outputting image options, the options are:</span>
<span class="c1">#             0 = normal, i.e. subtract final model from the data to create</span>
<span class="c1">#		  the residual image</span>
<span class="c1">#	      1 = Leave in the model -- do not subtract from the data</span>
<span class="c1">#</span>
<span class="c1"># column 3: allow parameter to vary (yes = 1, no = 0)</span>
<span class="c1"># column 4: comment</span>

<span class="c1"># Sersic function</span>

 <span class="mi">0</span><span class="p">)</span> <span class="n">sersic</span>             <span class="c1"># Object type</span>
 <span class="mi">1</span><span class="p">)</span> <span class="mf">300.</span>  <span class="mf">350.</span>  <span class="mi">1</span> <span class="mi">1</span>    <span class="c1"># position x, y        [pixel]</span>
 <span class="mi">3</span><span class="p">)</span> <span class="mf">20.00</span>      <span class="mi">1</span>       <span class="c1"># total magnitude    </span>
 <span class="mi">4</span><span class="p">)</span> <span class="mf">4.30</span>       <span class="mi">1</span>       <span class="c1">#     R_e              [Pixels]</span>
 <span class="mi">5</span><span class="p">)</span> <span class="mf">5.20</span>       <span class="mi">1</span>       <span class="c1"># Sersic exponent (deVauc=4, expdisk=1)  </span>
 <span class="mi">9</span><span class="p">)</span> <span class="mf">0.30</span>       <span class="mi">1</span>       <span class="c1"># axis ratio (b/a)   </span>
<span class="mi">10</span><span class="p">)</span> <span class="mf">10.0</span>       <span class="mi">1</span>       <span class="c1"># position angle (PA)  [Degrees: Up=0, Left=90]</span>
 <span class="n">Z</span><span class="p">)</span> <span class="mi">0</span>                  <span class="c1">#  Skip this model in output image?  (yes=1, no=0)</span>

<span class="c1"># Nuker function</span>

 <span class="mi">0</span><span class="p">)</span> <span class="n">nuker</span>              <span class="c1"># Object type</span>
 <span class="mi">1</span><span class="p">)</span> <span class="mf">250.</span>  <span class="mf">475.</span>  <span class="mi">1</span> <span class="mi">1</span>    <span class="c1"># position x, y        [pixel]</span>
 <span class="mi">3</span><span class="p">)</span> <span class="mf">17.2</span>       <span class="mi">1</span>       <span class="c1">#    mu(Rb)            [surface brightness mag. at Rb]</span>
 <span class="mi">4</span><span class="p">)</span> <span class="mf">20.5</span>       <span class="mi">1</span>       <span class="c1">#     Rb               [pixels]</span>
 <span class="mi">5</span><span class="p">)</span> <span class="mf">1.2</span>        <span class="mi">1</span>       <span class="c1">#    alpha  (sharpness of transition)</span>
 <span class="mi">6</span><span class="p">)</span> <span class="mf">0.5</span>        <span class="mi">1</span>       <span class="c1">#    beta   (outer powerlaw slope)</span>
 <span class="mi">7</span><span class="p">)</span> <span class="mf">0.7</span>        <span class="mi">1</span>       <span class="c1">#    gamma  (inner powerlaw slope)</span>
 <span class="mi">9</span><span class="p">)</span> <span class="mf">0.72</span>       <span class="mi">1</span>       <span class="c1"># axis ratio (b/a)   </span>
<span class="mi">10</span><span class="p">)</span> <span class="o">-</span><span class="mf">25.2</span>      <span class="mi">1</span>       <span class="c1"># position angle (PA)  [Degrees: Up=0, Left=90]</span>
 <span class="n">Z</span><span class="p">)</span> <span class="mi">0</span>                  <span class="c1">#  Skip this model in output image?  (yes=1, no=0)</span>

<span class="c1"># deVaucouleur function</span>

 <span class="mi">0</span><span class="p">)</span> <span class="n">devauc</span>             <span class="c1"># Object type</span>
 <span class="mi">1</span><span class="p">)</span> <span class="mf">301.2</span> <span class="mf">351.5</span> <span class="mi">1</span> <span class="mi">1</span>    <span class="c1"># position x, y        [pixel]</span>
 <span class="mi">3</span><span class="p">)</span> <span class="mf">18.</span>        <span class="mi">1</span>       <span class="c1"># total magnitude    </span>
 <span class="mi">4</span><span class="p">)</span> <span class="mf">32.</span>        <span class="mi">1</span>       <span class="c1">#     R_e              [Pixels]</span>
 <span class="mi">9</span><span class="p">)</span> <span class="mf">0.5</span>        <span class="mi">1</span>       <span class="c1"># axis ratio (b/a)   </span>
<span class="mi">10</span><span class="p">)</span> <span class="mf">107.</span>       <span class="mi">1</span>       <span class="c1"># position angle (PA)  [Degrees: Up=0, Left=90]</span>
 <span class="n">Z</span><span class="p">)</span> <span class="mi">0</span>                  <span class="c1">#  Skip this model in output image?  (yes=1, no=0)</span>

<span class="c1"># Exponential function</span>

 <span class="mi">0</span><span class="p">)</span> <span class="n">expdisk</span>            <span class="c1"># Object type</span>
 <span class="mi">1</span><span class="p">)</span> <span class="mf">405.</span>  <span class="mi">365</span>  <span class="mi">1</span> <span class="mi">1</span>     <span class="c1"># position x, y        [pixel]</span>
 <span class="mi">3</span><span class="p">)</span> <span class="mf">17.0</span>       <span class="mi">1</span>       <span class="c1"># total magnitude</span>
 <span class="mi">4</span><span class="p">)</span> <span class="mf">20.5</span>       <span class="mi">1</span>       <span class="c1">#     Rs               [Pixels]</span>
 <span class="mi">9</span><span class="p">)</span> <span class="mf">0.3</span>        <span class="mi">1</span>       <span class="c1"># axis ratio (b/a)   </span>
<span class="mi">10</span><span class="p">)</span> <span class="mi">25</span>         <span class="mi">1</span>       <span class="c1"># position angle (PA)  [Degrees: Up=0, Left=90]</span>
 <span class="n">Z</span><span class="p">)</span> <span class="mi">0</span>                  <span class="c1">#  Skip this model in output image?  (yes=1, no=0)</span>

<span class="c1"># Edge-on disk function</span>

 <span class="mi">0</span><span class="p">)</span> <span class="n">edgedisk</span>            <span class="c1"># Object type</span>
 <span class="mi">1</span><span class="p">)</span> <span class="mf">405.</span>  <span class="mi">365</span>  <span class="mi">1</span> <span class="mi">1</span>     <span class="c1"># position x, y        [pixel]</span>
 <span class="mi">3</span><span class="p">)</span> <span class="mf">17.0</span>       <span class="mi">1</span>       <span class="c1"># central surface brightness  [mag/arcsec^2]</span>
 <span class="mi">4</span><span class="p">)</span> <span class="mf">10.5</span>       <span class="mi">1</span>       <span class="c1"># disk scale-height    [Pixels]</span>
 <span class="mi">5</span><span class="p">)</span> <span class="mf">20.5</span>       <span class="mi">1</span>       <span class="c1"># disk scale-length    [Pixels]</span>
<span class="mi">10</span><span class="p">)</span> <span class="mi">25</span>         <span class="mi">1</span>       <span class="c1"># position angle (PA)  [Degrees: Up=0, Left=90]</span>
 <span class="n">Z</span><span class="p">)</span> <span class="mi">0</span>                  <span class="c1">#  Skip this model in output image?  (yes=1, no=0)</span>

<span class="c1"># Moffat function</span>
 
 <span class="mi">0</span><span class="p">)</span> <span class="n">moffat</span>             <span class="c1"># object type</span>
 <span class="mi">1</span><span class="p">)</span> <span class="mf">372.0</span>  <span class="mf">450.0</span> <span class="mi">1</span> <span class="mi">1</span>   <span class="c1"># position x, y        [pixel]</span>
 <span class="mi">3</span><span class="p">)</span> <span class="mf">16.5</span>       <span class="mi">1</span>       <span class="c1"># total magnitude     </span>
 <span class="mi">4</span><span class="p">)</span> <span class="mf">0.5</span>        <span class="mi">1</span>       <span class="c1">#   FWHM               [Pixels]</span>
 <span class="mi">5</span><span class="p">)</span> <span class="mf">1.5</span>        <span class="mi">1</span>       <span class="c1"># powerlaw      </span>
 <span class="mi">9</span><span class="p">)</span> <span class="mf">0.3</span>        <span class="mi">1</span>       <span class="c1"># axis ratio (b/a)   </span>
<span class="mi">10</span><span class="p">)</span> <span class="mi">25</span>         <span class="mi">1</span>       <span class="c1"># position angle (PA)  [Degrees: Up=0, Left=90]</span>
 <span class="n">Z</span><span class="p">)</span> <span class="mi">0</span>                  <span class="c1">#  Skip this model in output image?  (yes=1, no=0)</span>

<span class="c1"># Ferrer function</span>

 <span class="mi">0</span><span class="p">)</span> <span class="n">ferrer</span>             <span class="c1">#  Component type</span>
 <span class="mi">1</span><span class="p">)</span> <span class="mf">100.0</span> <span class="mf">100.0</span> <span class="mi">0</span> <span class="mi">0</span>    <span class="c1">#  Position x, y </span>
 <span class="mi">3</span><span class="p">)</span> <span class="mf">10.0000</span>     <span class="mi">0</span>      <span class="c1">#  Central surface brghtness [mag/arcsec^2]</span>
 <span class="mi">4</span><span class="p">)</span> <span class="mf">50.0000</span>     <span class="mi">0</span>      <span class="c1">#  Outer truncation radius  [pix]</span>
 <span class="mi">5</span><span class="p">)</span> <span class="mf">4.0000</span>      <span class="mi">0</span>      <span class="c1">#  Alpha (outer truncation sharpness) </span>
 <span class="mi">6</span><span class="p">)</span> <span class="mf">2.0000</span>      <span class="mi">0</span>      <span class="c1">#  Beta (central slope)</span>
 <span class="mi">9</span><span class="p">)</span> <span class="mf">0.5000</span>      <span class="mi">1</span>      <span class="c1">#  Axis ratio (b/a)  </span>
<span class="mi">10</span><span class="p">)</span> <span class="mf">50.0000</span>     <span class="mi">1</span>      <span class="c1">#  Position angle (PA) [deg: Up=0, Left=90]</span>
 <span class="n">Z</span><span class="p">)</span> <span class="mi">0</span>                  <span class="c1">#  Skip this model in output image?  (yes=1, no=0)</span>

<span class="c1"># Gaussian function</span>

 <span class="mi">0</span><span class="p">)</span> <span class="n">gaussian</span>           <span class="c1"># object type</span>
 <span class="mi">1</span><span class="p">)</span> <span class="mf">402.3</span>  <span class="mf">345.9</span>  <span class="mi">1</span> <span class="mi">1</span>  <span class="c1"># position x, y        [pixel]</span>
 <span class="mi">3</span><span class="p">)</span> <span class="mf">18.5</span>       <span class="mi">1</span>       <span class="c1"># total magnitude     </span>
 <span class="mi">4</span><span class="p">)</span> <span class="mf">0.5</span>        <span class="mi">0</span>       <span class="c1">#   FWHM               [pixels]</span>
 <span class="mi">9</span><span class="p">)</span> <span class="mf">0.3</span>        <span class="mi">1</span>       <span class="c1"># axis ratio (b/a)   </span>
<span class="mi">10</span><span class="p">)</span> <span class="mi">25</span>         <span class="mi">1</span>       <span class="c1"># position angle (PA)  [Degrees: Up=0, Left=90]</span>
 <span class="n">Z</span><span class="p">)</span> <span class="mi">0</span>                  <span class="c1"># leave in [1] or subtract [0] this comp from data?</span>

<span class="c1"># The Empirical King Profile</span>

 <span class="mi">0</span><span class="p">)</span>       <span class="n">king</span>         <span class="c1"># Object type</span>
 <span class="mi">1</span><span class="p">)</span> <span class="mf">49.9925</span> <span class="mf">49.9705</span> <span class="mi">1</span> <span class="mi">1</span>  <span class="c1">#   position x, y</span>
 <span class="mi">3</span><span class="p">)</span> <span class="mf">14.9805</span>    <span class="mi">1</span>       <span class="c1">#  mu(0) </span>
 <span class="mi">4</span><span class="p">)</span> <span class="mf">10.1328</span>    <span class="mi">1</span>       <span class="c1">#   Rc </span>
 <span class="mi">5</span><span class="p">)</span> <span class="mf">51.0968</span>    <span class="mi">1</span>       <span class="c1">#   Rt </span>
 <span class="mi">6</span><span class="p">)</span> <span class="mf">2.0485</span>     <span class="mi">1</span>       <span class="c1"># alpha </span>
 <span class="mi">9</span><span class="p">)</span> <span class="mf">0.9918</span>     <span class="mi">1</span>       <span class="c1"># axis ratio (b/a)  </span>
<span class="mi">10</span><span class="p">)</span> <span class="mf">20.7684</span>    <span class="mi">1</span>       <span class="c1"># position angle (PA) </span>
 <span class="n">Z</span><span class="p">)</span> <span class="mi">0</span>                  <span class="c1">#  Skip this model in output image?  (yes=1, no=0)</span>

<span class="c1"># PSF fit.</span>

 <span class="mi">0</span><span class="p">)</span> <span class="n">psf</span>                <span class="c1"># object type</span>
 <span class="mi">1</span><span class="p">)</span> <span class="mf">402.3</span>  <span class="mf">345.9</span>  <span class="mi">1</span> <span class="mi">1</span>  <span class="c1"># position x, y        [pixel]</span>
 <span class="mi">3</span><span class="p">)</span> <span class="mf">18.5</span>       <span class="mi">1</span>       <span class="c1"># total magnitude     </span>
 <span class="n">Z</span><span class="p">)</span> <span class="mi">0</span>                  <span class="c1">#  Skip this model in output image?  (yes=1, no=0)</span>

<span class="c1"># sky</span>

 <span class="mi">0</span><span class="p">)</span> <span class="n">sky</span>
 <span class="mi">1</span><span class="p">)</span> <span class="mf">0.77</span>       <span class="mi">0</span>       <span class="c1"># sky background       [ADU counts]</span>
 <span class="mi">2</span><span class="p">)</span> <span class="mf">0.000</span>      <span class="mi">0</span>       <span class="c1"># dsky/dx (sky gradient in x) </span>
 <span class="mi">3</span><span class="p">)</span> <span class="mf">0.000</span>      <span class="mi">0</span>       <span class="c1"># dsky/dy (sky gradient in y) </span>
 <span class="n">Z</span><span class="p">)</span> <span class="mi">0</span>                  <span class="c1">#  Skip this model in output image?  (yes=1, no=0)</span>

<span class="c1"># The parameters C0, B1, B2, F1, F2, etc. listed below are hidden </span>
<span class="c1"># from the user unless he/she explicitly requests them.  These can </span>
<span class="c1"># be tagged on to the end of any previous components except, of </span>
<span class="c1"># course, the PSF and the sky -- although galfit won&#39;t bar you from doing </span>
<span class="c1"># so, and will just ignore them.  Note that a Fourier or Bending mode </span>
<span class="c1"># amplitude of exactly 0 will cause GALFIT to crash because the </span>
<span class="c1"># derivative image GALFIT computes internally will be entirely 0.  If a </span>
<span class="c1"># Fourier or Bending amplitude is set to 0 initially GALFIT will reset it  </span>
<span class="c1"># to a value of 0.01.  To prevent GALFIT from doing so, one can set it to any </span>
<span class="c1"># other value.</span>

<span class="c1">#  Bending modes</span>
<span class="n">B1</span><span class="p">)</span>  <span class="mf">0.07</span>      <span class="mi">1</span>       <span class="c1"># Bending mode 1 (shear)</span>
<span class="n">B2</span><span class="p">)</span>  <span class="mf">0.01</span>      <span class="mi">1</span>       <span class="c1"># Bending mode 2 (banana shape)</span>
<span class="n">B3</span><span class="p">)</span>  <span class="mf">0.03</span>      <span class="mi">1</span>       <span class="c1"># Bending mode 3 (S-shape)</span>

<span class="c1">#  Azimuthal fourier modes</span>
<span class="n">F1</span><span class="p">)</span>  <span class="mf">0.07</span>  <span class="mf">30.1</span>  <span class="mi">1</span>  <span class="mi">1</span>  <span class="c1"># Az. Fourier mode 1, amplitude and phase angle</span>
<span class="n">F2</span><span class="p">)</span>  <span class="mf">0.01</span>  <span class="mf">10.5</span>  <span class="mi">1</span>  <span class="mi">1</span>  <span class="c1"># Az. Fourier mode 2, amplitude and phase angle</span>
<span class="n">F6</span><span class="p">)</span>  <span class="mf">0.03</span>  <span class="mf">10.5</span>  <span class="mi">1</span>  <span class="mi">1</span>  <span class="c1"># Az. Fourier mode 6, amplitude and phase angle</span>
<span class="n">F10</span><span class="p">)</span>  <span class="mf">0.08</span>  <span class="mf">20.5</span>  <span class="mi">1</span>  <span class="mi">1</span>  <span class="c1"># Az. Fourier mode 10, amplitude and phase angle</span>
<span class="n">F20</span><span class="p">)</span>  <span class="mf">0.01</span>  <span class="mf">23.5</span>  <span class="mi">1</span>  <span class="mi">1</span>  <span class="c1"># Az. Fourier mode 20, amplitude and phase angle</span>

<span class="c1">#  Traditional Diskyness/Boxyness parameter c</span>
<span class="n">C0</span><span class="p">)</span> <span class="mf">0.1</span>         <span class="mi">0</span>      <span class="c1"># traditional diskyness(-)/boxyness(+)</span>

<span class="c1">#  PA rotation is used most often to create spiral galaxies, although</span>
<span class="c1">#  it can be used to fit isophotal rotations too.  Note that the parameters</span>
<span class="c1">#  R9 (inclination to line of sight) and R10 (sky position angle) differ </span>
<span class="c1">#  very subtly (but importantly) from the classical axis ratio (q, parameter </span>
<span class="c1">#  9) and position angle (PA, 10), so you need to understand the</span>
<span class="c1">#  distinction well.  R9 and R10 should be set to 0 if one is modeling early</span>
<span class="c1">#  type galaxies, because otherwise they are completely degenerate with</span>
<span class="c1">#  the classical q and PA.  R9 and R10 are used to project a spiral galaxy </span>
<span class="c1">#  disk, assumed to be round viewed face on (i.e. inclination of 0 degrees, </span>
<span class="c1">#  R9=0), to other orientations and flattening.  The disk orientation, R10 </span>
<span class="c1">#  is 0 when pointing up and increases counter-clockwise, just like usual.  </span>
<span class="c1">#  When viewed face on, the thickness of the spiral arm is controlled by </span>
<span class="c1">#  classical parameter 9, i.e. the axis ratio.  When R9 and R10 are zero, </span>
<span class="c1">#  everything is what you are used to with the old GALFIT.  If R9 and R10 are </span>
<span class="c1">#  not 0, then the classical parameters 9 and 10 (q, PA) will be a bit </span>
<span class="c1">#  un-intuitive, but perfectly internally consistent with the scheme just </span>
<span class="c1">#  described.  For spiral galaxies, when and both R9 and R10 are 0, the </span>
<span class="c1">#  classical position angle corresponds to the PA of the galaxy bar.  This all </span>
<span class="c1">#  sounds pretty confusing because you&#39;re just reading.  But once you start </span>
<span class="c1">#  playing with it it&#39;ll become more clear what I&#39;m talking about.</span>
<span class="c1">#  To have GALFIT generate some example galaxies, set P=1.</span>
<span class="c1">#</span>
<span class="c1">#  Note that you can couple an arbitrary number of Fourier components with</span>
<span class="c1">#  coordinate rotation.  If you do so, you can create very complex,</span>
<span class="c1">#  multi-armed, spiral structures, and arms that have different</span>
<span class="c1">#  thicknesses.</span>

<span class="n">R0</span><span class="p">)</span> <span class="n">powerlaw</span>	       <span class="c1"># PA rotation function (power, log, none)</span>
<span class="n">R1</span><span class="p">)</span> <span class="mf">30.</span>        <span class="mi">1</span>       <span class="c1"># bar radius  [pixels]</span>
<span class="n">R2</span><span class="p">)</span> <span class="mf">100.</span>       <span class="mi">1</span>       <span class="c1"># 96% asymptotic radius (i.e. at 96% of tanh rotation)</span>
<span class="n">R3</span><span class="p">)</span> <span class="mf">275.</span>       <span class="mi">1</span>       <span class="c1"># cumul. coord. rotation out to asymp. radius [degrees] </span>
<span class="n">R4</span><span class="p">)</span> <span class="mf">0.5</span>	       <span class="mi">1</span>       <span class="c1"># asymptotic spiral arm powerlaw </span>
<span class="n">R9</span><span class="p">)</span> <span class="mf">0.5</span>	       <span class="mi">1</span>       <span class="c1"># inclination to L.o.S. (controls projected axis ratio)</span>
<span class="n">R10</span><span class="p">)</span> <span class="mf">30.</span>       <span class="mi">1</span>       <span class="c1"># sky position angle</span>

<span class="c1">#  The other coordinate rotation function is the log function.</span>

<span class="n">R0</span><span class="p">)</span> <span class="n">log</span>                <span class="c1"># PA rotation func. (tanh, sqrt, log, linear, none)</span>
<span class="n">R1</span><span class="p">)</span> <span class="mf">30.</span>        <span class="mi">1</span>       <span class="c1"># bar radius  [pixels]</span>
<span class="n">R2</span><span class="p">)</span> <span class="mf">100.</span>       <span class="mi">1</span>       <span class="c1"># 96% asymptotic radius (i.e. at 96% of tanh rotation)</span>
<span class="n">R3</span><span class="p">)</span> <span class="o">-</span><span class="mf">59.9192</span>   <span class="mi">1</span>       <span class="c1"># cumul. coord. rotation out to asymp. radius [degrees]</span>
<span class="n">R4</span><span class="p">)</span> <span class="mf">10.</span>	       <span class="mi">1</span>       <span class="c1"># Logarithmic winding scale radius [pixels]</span>
<span class="n">R9</span><span class="p">)</span> <span class="o">-</span><span class="mf">56.2757</span>   <span class="mi">1</span>       <span class="c1"># Inclination to L.o.S. [degrees]</span>
<span class="n">R10</span><span class="p">)</span> <span class="mf">157.9937</span>  <span class="mi">1</span>       <span class="c1"># Sky position angle</span>

<span class="c1">#  Create a truncation by multiplying a profile function with a</span>
<span class="c1">#  hyperbolic tangent transition.  The break radius, r_break, is defined</span>
<span class="c1">#  as the radius which has 99% the flux of an original function, whereas</span>
<span class="c1">#  the softening radius, r_soft, is where the function has only 1% of the </span>
<span class="c1">#  flux of the original.  Under normal circumstances, r_break &lt; r_soft.  </span>
<span class="c1">#  On the other hand, r_break &gt; r_soft is also possible.  This happens,</span>
<span class="c1">#  for instance, if one wants to generate a ring model with a hyperbolic</span>
<span class="c1">#  tangent truncation in the inner region.</span>
<span class="c1">#</span>
<span class="c1">#  When multiple profiles are linked, mathematically they are linked by:</span>
<span class="c1">#    f_net(r) = Sum{f_inner(r)} * (1-s(r)) + Sum{f_outer(r)} * s(r).</span>
<span class="c1">#  The transition radii are shared by the inner &amp; outer functions in the</span>
<span class="c1">#  sense that r_break is where inner profiles reaches 99% of their normal </span>
<span class="c1">#  flux; it is also the radius where the outer functions reaches 1% of their </span>
<span class="c1">#  own normal flux, and vice versa.  When this happens, be careful that the </span>
<span class="c1">#  sense of the break vs. asymptotic radius are in the correct sense, or </span>
<span class="c1">#  else things can get very confusing very quickly.  So as to minimize </span>
<span class="c1">#  confusion when linking, consistently use r_break &lt; r_soft.</span>
<span class="c1">#  </span>
<span class="c1">#  When linking two profiles, the flux parameter for the inner component </span>
<span class="c1">#  is the surface brightness at the original (untruncated) effective </span>
<span class="c1">#  radius &quot;Re&quot; for the Sersic profile instead of the total flux, or central</span>
<span class="c1">#  surface brightness for all other profiles (gaussian, moffat, etc.).</span>
<span class="c1">#  The outer component flux normalization is the surface brightness</span>
<span class="c1">#  at the **break** radius.  </span>
<span class="c1">#</span>
<span class="c1">#  Note that the Fourier and bending modes can operate on the truncation</span>
<span class="c1">#  parameters independently of the light component that the truncation </span>
<span class="c1">#  parameters are modifying.</span>
<span class="c1">#  </span>
<span class="c1">#        </span>
<span class="c1">#        v---  r_break ---v</span>
<span class="c1">#        </span>
<span class="c1">#        ____           ___</span>
<span class="c1">#       /                  \</span>
<span class="c1">#   ___/                    \___</span>
<span class="c1">#</span>
<span class="c1">#      ^----   r_soft   ----^</span>
<span class="c1">#</span>
<span class="c1">#  There are 4 kinds of truncation modes, designated by, &quot;radial&quot;, &quot;radial-b&quot;,</span>
<span class="c1">#  for Type 1, versus &quot;radial2&quot;, and &quot;radial2-b&quot; for Type 2.  </span>
<span class="c1">#</span>
<span class="c1">#  The difference between Type 1 and Type 2 is in the definition of </span>
<span class="c1">#  parameters T3 and T4.  For Type 1, T3 is &quot;Break radius&quot;, and T4 is</span>
<span class="c1">#  the &quot;Softening length&quot;, i.e. (R_break) and (Delta R).  For Type 2, T3 is </span>
<span class="c1">#  still the &quot;Break radius&quot;, but T4 is the &quot;Softening radius&quot;, i.e. </span>
<span class="c1">#  inner and outer break radius.  </span>
<span class="c1">#</span>
<span class="c1">#  As for Type &quot;b&quot; versus Type &quot;a&quot; (i.e. non-b), the difference is that</span>
<span class="c1">#  &quot;Type a&quot; is intended for spiral structures, i.e. the truncation shape </span>
<span class="c1">#  (axis ratio and PA) are tilted and rotated by the same angles as the </span>
<span class="c1">#  spiral arms.  Whereas for &quot;Type b&quot; truncations, the shape parameters</span>
<span class="c1">#  refer to how they appear in projection, i.e. in the plane of the sky.</span>
<span class="c1">#  For non-spiral models, there&#39;s no difference between &quot;Type a&quot; and</span>
<span class="c1">#  &quot;Type b&quot;.</span>

<span class="c1"># Truncated Sersic function</span>
 <span class="mi">0</span><span class="p">)</span> <span class="n">sersic</span>             <span class="c1"># Object type</span>
 <span class="mi">1</span><span class="p">)</span> <span class="mf">300.</span>  <span class="mf">350.</span>  <span class="mi">1</span> <span class="mi">1</span>    <span class="c1"># position x, y        [pixel]</span>
 <span class="mi">3</span><span class="p">)</span> <span class="mf">20.00</span>      <span class="mi">1</span>       <span class="c1"># total magnitude    </span>
 <span class="mi">4</span><span class="p">)</span> <span class="mf">4.30</span>       <span class="mi">1</span>       <span class="c1">#     R_e              [Pixels]</span>
 <span class="mi">5</span><span class="p">)</span> <span class="mf">5.20</span>       <span class="mi">1</span>       <span class="c1"># Sersic exponent (deVauc=4, expdisk=1)  </span>
 <span class="mi">9</span><span class="p">)</span> <span class="mf">0.30</span>       <span class="mi">1</span>       <span class="c1"># axis ratio (b/a)   </span>
<span class="mi">10</span><span class="p">)</span> <span class="mf">10.0</span>       <span class="mi">1</span>       <span class="c1"># position angle (PA)  [Degrees: Up=0, Left=90]</span>
<span class="n">Ti</span><span class="p">)</span> <span class="mi">5</span>                  <span class="c1"># Inner truncation by component 5</span>
<span class="n">To</span><span class="p">)</span> <span class="mi">2</span>                  <span class="c1"># Outer truncation by component 2</span>
 <span class="n">Z</span><span class="p">)</span> <span class="mi">0</span>                  <span class="c1"># leave in [1] or subtract [0] this comp from data?</span>

<span class="c1"># Object number: 5</span>
<span class="n">T0</span><span class="p">)</span> <span class="n">radial</span>                 <span class="c1">#  truncation </span>
<span class="n">T1</span><span class="p">)</span> <span class="mf">200.</span>  <span class="mf">150.</span>  <span class="mi">1</span> <span class="mi">1</span>        <span class="c1">#  Centroid of truncation function (optional)</span>
<span class="n">T4</span><span class="p">)</span> <span class="mf">4.4179</span>      <span class="mi">1</span>          <span class="c1">#  Break radius (99% normal flux)    [pixels]</span>
<span class="n">T5</span><span class="p">)</span> <span class="mf">9.1777</span>      <span class="mi">1</span>          <span class="c1">#  Softening length (1% normal flux) [pixels]</span>
<span class="n">T9</span><span class="p">)</span>  <span class="mf">0.7</span>        <span class="mi">1</span>          <span class="c1">#  Axis ratio (optional)</span>
<span class="n">T10</span><span class="p">)</span>  <span class="o">-</span><span class="mf">32.</span>      <span class="mi">1</span>          <span class="c1">#  Position angle (optional)</span>
<span class="n">F1</span><span class="p">)</span> <span class="mf">0.1</span>  <span class="mi">30</span>     <span class="mi">1</span>          <span class="c1">#  Fourier mode1 (now modifying truncation)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set output directory</span>
<span class="n">DIR_OUTPUT</span> <span class="o">=</span> <span class="s1">&#39;output&#39;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">cwd</span><span class="o">/</span><span class="n">DIR_OUTPUT</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="p">(</span><span class="n">cwd</span><span class="o">/</span><span class="n">DIR_OUTPUT</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SCALE</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.396127
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PA_GUESS</span> <span class="o">=</span> <span class="mf">13.</span>
<span class="c1"># Construct the GALFIT input file (*.feedme)</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.feedme&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="c1"># Image and GALFIT control parameters (Section 8.1)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A) </span><span class="si">{</span><span class="n">DIR_INPUT</span><span class="si">}</span><span class="s2">/input_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">-r.fits</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>              <span class="c1"># Input data image</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;B) </span><span class="si">{</span><span class="n">DIR_OUTPUT</span><span class="si">}</span><span class="s2">/block_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">-r.fits</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>             <span class="c1"># Output data image block</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;C) </span><span class="si">{</span><span class="n">DIR_INPUT</span><span class="si">}</span><span class="s2">/sigma_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">-r.fits</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>              <span class="c1"># Sigma image name</span>
<span class="c1"># f.write(&quot;C) none\n&quot;)                                          # Sigma image name</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;D) </span><span class="si">{</span><span class="n">DIR_INPUT</span><span class="si">}</span><span class="s2">/psf_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">-r.fits</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                <span class="c1"># Input PSF image</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;E) 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                             <span class="c1"># PSF find sampling factor relative to data</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F) </span><span class="si">{</span><span class="n">DIR_INPUT</span><span class="si">}</span><span class="s2">/mask_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">-r.fits</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                          <span class="c1"># Bad pixel mask</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;G) </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.constrain</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                           <span class="c1"># File with parameter constraints</span>
<span class="c1"># f.write(&quot;G) none\n&quot;)                                          # File with parameter constraints</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;H) </span><span class="si">{</span><span class="mi">1</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="mi">1</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>    <span class="c1"># Image region to fit (xmin xmax ymin ymax)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;I) </span><span class="si">{</span><span class="mi">50</span><span class="o">*</span><span class="n">fwhm</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="mi">50</span><span class="o">*</span><span class="n">fwhm</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                          <span class="c1"># Size of the convolution box (x y) https://users.obs.carnegiescience.edu/peng/work/galfit/TFAQ.html#convbox</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;J) 22.5</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                          <span class="c1"># Magnitude photometric zeropoint</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;K) </span><span class="si">{</span><span class="n">SCALE</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">SCALE</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                              <span class="c1"># Plate scale (dx dy) [arcsec per pixel]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;O) regular</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                       <span class="c1"># Display type (regular, curses, both)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;P) 0</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>                                           <span class="c1"># Options (0 = normal run; 1,2 = make model/imgblock &amp; quit)</span>

<span class="c1"># Initial fitting parameters</span>
<span class="c1">#</span>
<span class="c1">#   For object type, the allowed functions are: </span>
<span class="c1">#       nuker, sersic, expdisk, devauc, king, psf, gaussian, moffat, </span>
<span class="c1">#       ferrer, powsersic, sky, and isophote. </span>
<span class="c1">#  </span>
<span class="c1">#   Hidden parameters will only appear when they&#39;re specified:</span>
<span class="c1">#       C0 (diskyness/boxyness), </span>
<span class="c1">#       Fn (n=integer, Azimuthal Fourier Modes),</span>
<span class="c1">#       R0-R10 (PA rotation, for creating spiral structures).</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1">#  Classical Object Fitting Parameters 0-10, and Z (Section 8.2)</span>
<span class="c1">#  The second parameter determines whether the parameter should be fixed (0) or not (1).</span>

<span class="c1"># M51A -  compound bulge 1</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0) sersic</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                        <span class="c1"># Object type</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1) </span><span class="si">{</span><span class="n">x_a</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_a</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                      <span class="c1"># Position (x, y)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;3) </span><span class="si">{</span><span class="mf">13.09</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                <span class="c1"># Total magnitude</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;4) </span><span class="si">{</span><span class="mf">0.04</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="n">SCALE</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                        <span class="c1"># R_e [pix]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;5) </span><span class="si">{</span><span class="mf">1.18</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                 <span class="c1"># Sersic exponent</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;9) </span><span class="si">{</span><span class="mf">0.91</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                 <span class="c1"># Axis ratio (b/a)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;10) </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">-</span><span class="mf">15.25</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                      <span class="c1"># Position angle (PA) [deg: Up=0, Left=90]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Z) 0</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>                                           <span class="c1"># Skip this model in output image? (yes=1, no=0)</span>

<span class="c1"># M51A -  compound bulge 2</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0) sersic</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                        <span class="c1"># Object type</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1) </span><span class="si">{</span><span class="n">x_a</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_a</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                      <span class="c1"># Position (x, y)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;3) </span><span class="si">{</span><span class="mf">10.49</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                <span class="c1"># Total magnitude</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;4) </span><span class="si">{</span><span class="mf">0.26</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="n">SCALE</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                        <span class="c1"># R_e [pix]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;5) </span><span class="si">{</span><span class="mf">1.</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                   <span class="c1"># Sersic exponent</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;9) </span><span class="si">{</span><span class="mf">0.9</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                  <span class="c1"># Axis ratio (b/a)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;10) </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">-</span><span class="mf">65.31</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                      <span class="c1"># Position angle (PA) [deg: Up=0, Left=90]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Z) 0</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># M51A -  first spiral component</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0) sersic</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                        <span class="c1"># Object type</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1) </span><span class="si">{</span><span class="n">x_a</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_a</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                      <span class="c1"># Position (x, y)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;3) </span><span class="si">{</span><span class="mf">8.5</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                  <span class="c1"># Total magnitude</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;4) </span><span class="si">{</span><span class="mf">2.78</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="n">SCALE</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                        <span class="c1"># R_e [pix]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;5) </span><span class="si">{</span><span class="mf">0.35</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                 <span class="c1"># Sersic exponent</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;9) </span><span class="si">{</span><span class="mf">0.75</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                 <span class="c1"># Axis ratio (b/a)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;10) </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">-</span><span class="mf">87.22</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                      <span class="c1"># Position angle (PA) [deg: Up=0, Left=90]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R0) power&quot;</span><span class="p">)</span>                                         <span class="c1"># PA rotation function</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R1) </span><span class="si">{</span><span class="o">-</span><span class="mf">1.29</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="n">SCALE</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                      <span class="c1"># bar radius [pix]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R2) </span><span class="si">{</span><span class="mf">4.28</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="n">SCALE</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                       <span class="c1"># 96% asymptotic radius [pix]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R3) </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">-</span><span class="mf">718.11</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                     <span class="c1"># cumul. coord. rotation out to asymp. radius [deg] </span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R4) </span><span class="si">{</span><span class="mf">0.29</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                <span class="c1"># asymptotic spiral arm powerlaw [deg]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R9) </span><span class="si">{</span><span class="mf">40.42</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                               <span class="c1"># inclination to L.o.S [deg]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R10) </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">-</span><span class="mf">82.20</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                     <span class="c1"># sky position angle [deg]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1) </span><span class="si">{</span><span class="o">-</span><span class="mf">0.07</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">+</span><span class="mf">109.10</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>       <span class="c1"># Az. Fourier mode 1, amplitude and phase angle</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F3) </span><span class="si">{</span><span class="mf">0.03</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">+</span><span class="mf">4.07</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>          <span class="c1"># Az. Fourier mode 3, amplitude and phase angle</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F4) </span><span class="si">{</span><span class="mf">0.02</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">-</span><span class="mf">36.57</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>         <span class="c1"># Az. Fourier mode 4, amplitude and phase angle</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F5) </span><span class="si">{</span><span class="mf">0.02</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">+</span><span class="mf">24.34</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>         <span class="c1"># Az. Fourier mode 5, amplitude and phase angle</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Z) 0</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># M51A -  second spiral component</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0) sersic</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                        <span class="c1"># Object type</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1) </span><span class="si">{</span><span class="n">x_a</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_a</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                      <span class="c1"># Position (x, y)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;3) </span><span class="si">{</span><span class="mf">10.06</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                <span class="c1"># Total magnitude</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;4) </span><span class="si">{</span><span class="mf">1.88</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="n">SCALE</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                        <span class="c1"># R_e [pix]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;5) </span><span class="si">{</span><span class="mf">0.14</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                 <span class="c1"># Sersic exponent</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;9) </span><span class="si">{</span><span class="mf">0.39</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                 <span class="c1"># Axis ratio (b/a)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;10) </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">+</span><span class="mf">5.45</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                       <span class="c1"># Position angle (PA) [deg: Up=0, Left=90]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R0) power</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                         <span class="c1"># PA rotation function</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R1) </span><span class="si">{</span><span class="mf">0.66</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="n">SCALE</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                       <span class="c1"># bar radius [pix]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R2) </span><span class="si">{</span><span class="mf">2.34</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="n">SCALE</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                       <span class="c1"># 96% asymptotic radius [pix]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R3) </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">-</span><span class="mf">172.67</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                     <span class="c1"># cumul. coord. rotation out to asymp. radius [deg] </span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R4) </span><span class="si">{</span><span class="o">-</span><span class="mf">0.11</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                               <span class="c1"># asymptotic spiral arm powerlaw [deg]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R9) </span><span class="si">{</span><span class="o">-</span><span class="mf">0.01</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                               <span class="c1"># inclination to L.o.S [deg]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R10) </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">+</span><span class="mf">15.58</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                     <span class="c1"># sky position angle [deg]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1) </span><span class="si">{</span><span class="o">-</span><span class="mf">0.15</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">+</span><span class="mf">25.39</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>        <span class="c1"># Az. Fourier mode 1, amplitude and phase angle</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F3) </span><span class="si">{</span><span class="mf">0.02</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">-</span><span class="mf">32.12</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>         <span class="c1"># Az. Fourier mode 3, amplitude and phase angle</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F4) </span><span class="si">{</span><span class="mf">0.15</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">+</span><span class="mf">8.38</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>          <span class="c1"># Az. Fourier mode 4, amplitude and phase angle</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F5) </span><span class="si">{</span><span class="mf">0.02</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">-</span><span class="mf">4.02</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>          <span class="c1"># Az. Fourier mode 5, amplitude and phase angle</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Z) 0</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># M51B -  compound bulge 1</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0) sersic</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                        <span class="c1"># Object type</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1) </span><span class="si">{</span><span class="n">x_b</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_b</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                      <span class="c1"># Position (x, y)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;3) </span><span class="si">{</span><span class="mf">12.06</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                <span class="c1"># Total magnitude</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;4) </span><span class="si">{</span><span class="mf">0.05</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="n">SCALE</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                        <span class="c1"># R_e [pix]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;5) </span><span class="si">{</span><span class="mf">0.89</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                 <span class="c1"># Sersic exponent</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;9) </span><span class="si">{</span><span class="mf">0.62</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                 <span class="c1"># Axis ratio (b/a)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;10) </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">-</span><span class="mf">72.22</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                <span class="c1"># Position angle (PA) [deg: Up=0, Left=90]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Z) 0</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>  

<span class="c1"># M51B -  compound bulge 2</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0) sersic</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                        <span class="c1"># Object type</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1) </span><span class="si">{</span><span class="n">x_b</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_b</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                      <span class="c1"># Position (x, y)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;3) </span><span class="si">{</span><span class="mf">11.93</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                <span class="c1"># Total magnitude</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;4) </span><span class="si">{</span><span class="mf">0.18</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="n">SCALE</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                        <span class="c1"># R_e [pix]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;5) </span><span class="si">{</span><span class="mf">1.06</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                 <span class="c1"># Sersic exponent</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;9) </span><span class="si">{</span><span class="mf">0.81</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                 <span class="c1"># Axis ratio (b/a)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;10) </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">-</span><span class="mf">2.79</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                       <span class="c1"># Position angle (PA) [deg: Up=0, Left=90]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Z) 0</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>  

<span class="c1"># # M51B -  tidal structure</span>
<span class="c1"># f.write(&quot;0) sersic\n&quot;)                                        # Object type</span>
<span class="c1"># f.write(f&quot;1) {x_b:.2f} {y_b:.2f} 1 1\n&quot;)                      # Position (x, y)</span>
<span class="c1"># f.write(f&quot;3) {9.93:.3f} 1\n&quot;)                                 # Total magnitude</span>
<span class="c1"># f.write(f&quot;4) {2.51*60/SCALE:.2f} 1\n&quot;)                        # R_e [pix]</span>
<span class="c1"># f.write(f&quot;5) {1.0:.1f} 0\n&quot;)                                  # Sersic exponent</span>
<span class="c1"># f.write(f&quot;9) {0.62:.3f} 1\n&quot;)                                 # Axis ratio (b/a)</span>
<span class="c1"># f.write(f&quot;10) {PA_GUESS-96.19:.2f} 1\n&quot;)                      # Position angle (PA) [deg: Up=0, Left=90]</span>
<span class="c1"># f.write(f&quot;B2) {0.03*60*SCALE:.2f} 1\n&quot;)                       # Bending mode 2 (banana shape)</span>
<span class="c1"># f.write(f&quot;B3) {-0.15*60*SCALE:.2f} 1\n&quot;)                      # Bending mode 3 (S-shape)</span>
<span class="c1"># f.write(f&quot;F1) {0.34:.2f} {PA_GUESS+17.20:.2f} 1 1\n&quot;)         # Az. Fourier mode 1, amplitude and phase angle</span>
<span class="c1"># f.write(f&quot;F3) {-0.25:.2f} {PA_GUESS+32.55:.2f} 1 1\n&quot;)        # Az. Fourier mode 3, amplitude and phase angle</span>
<span class="c1"># f.write(f&quot;F4) {0.14:.2f} {PA_GUESS-3.73:.2f} 1 1\n&quot;)          # Az. Fourier mode 4, amplitude and phase angle</span>
<span class="c1"># f.write(f&quot;F5) {0.03:.2f} {PA_GUESS+7.32:.2f} 1 1\n&quot;)          # Az. Fourier mode 5, amplitude and phase angle</span>
<span class="c1"># f.write(&quot;Z) 0\n\n&quot;)  </span>

<span class="c1"># M51B -  bar and spiral</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0) sersic</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                        <span class="c1"># Object type</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1) </span><span class="si">{</span><span class="n">x_b</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_b</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                      <span class="c1"># Position (x, y)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;3) </span><span class="si">{</span><span class="mf">10.2</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                 <span class="c1"># Total magnitude</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;4) </span><span class="si">{</span><span class="mf">0.9</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="n">SCALE</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                         <span class="c1"># R_e [pix]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;5) </span><span class="si">{</span><span class="mf">0.72</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                 <span class="c1"># Sersic exponent</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;9) </span><span class="si">{</span><span class="mf">0.58</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                 <span class="c1"># Axis ratio (b/a)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;10) </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">-</span><span class="mf">46.52</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                      <span class="c1"># Position angle (PA) [deg: Up=0, Left=90]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R0) power&quot;</span><span class="p">)</span>                                         <span class="c1"># PA rotation function</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R1) </span><span class="si">{</span><span class="mf">0.88</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="n">SCALE</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                       <span class="c1"># bar radius [pix]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R2) </span><span class="si">{</span><span class="mf">1.08</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="n">SCALE</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                       <span class="c1"># 96% asymptotic radius [pix]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R3) </span><span class="si">{</span><span class="mf">46.34</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                               <span class="c1"># cumul. coord. rotation out to asymp. radius [deg] </span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R4) </span><span class="si">{</span><span class="mf">1.60</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                <span class="c1"># asymptotic spiral arm powerlaw [deg]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R9) </span><span class="si">{</span><span class="mf">42.29</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                               <span class="c1"># inclination to L.o.S [deg]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R10) </span><span class="si">{</span><span class="mf">52.50</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                              <span class="c1"># sky position angle [deg]</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1) </span><span class="si">{</span><span class="mf">0.07</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">+</span><span class="mf">103.72</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>        <span class="c1"># Az. Fourier mode 1, amplitude and phase angle</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F3) </span><span class="si">{</span><span class="mf">0.05</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">+</span><span class="mf">28.79</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>         <span class="c1"># Az. Fourier mode 3, amplitude and phase angle</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F4) </span><span class="si">{</span><span class="mf">0.01</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">-</span><span class="mf">0.11</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>          <span class="c1"># Az. Fourier mode 4, amplitude and phase angle</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F5) </span><span class="si">{</span><span class="mf">0.01</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">PA_GUESS</span><span class="o">+</span><span class="mf">23.12</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> 1 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>         <span class="c1"># Az. Fourier mode 5, amplitude and phase angle</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Z) 0</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>  

<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0) sky</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;1) 0.00 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                        <span class="c1"># Sky background</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;2) 0.00 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                        <span class="c1"># dsky/dx</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;3) 0.00 1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                                        <span class="c1"># dsky/dy</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Z) 0 1</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>                                         <span class="c1"># Skip this model in output image?</span>

<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The values above are put considering the best-fit values of Table 4. of Peng et al. (2010).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build the GALFIT constraint file (*.constrain)</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.constrain&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;1_2_3_4 x offset</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># couples x coordinate of component 1, 2, 3, and 4</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;1_2_3_4 y offset</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run GALFIT! (I recommend you to run GALFIT in the terminal)</span>
<span class="n">PATH_GALFIT</span> <span class="o">=</span> <span class="s2">&quot;~/Downloads/galfit&quot;</span>
<span class="c1"># os.system(f&quot;{PATH_GALFIT} {name}.feedme&quot;)</span>
<span class="c1"># os.system(&quot;mv -v fit.log &quot;+(cwd/DIR_OUTPUT).as_posix()+f&quot;/Result_{name}.log&quot;)</span>
<span class="c1"># os.system(&quot;rm -rfv galfit.*&quot;)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">PATH_GALFIT</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.feedme&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mv -v fit.log </span><span class="si">{</span><span class="p">(</span><span class="n">cwd</span><span class="o">/</span><span class="n">DIR_OUTPUT</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span><span class="si">}</span><span class="s2">/Result_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.log&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>~/Downloads/galfit J132947.00+471338.0.feedme
mv -v fit.log /Users/hbahk/class/TAOtutorials/tutorials/data/proj4/output/Result_J132947.00+471338.0.log
</pre></div>
</div>
</div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The GALFIT process above takes a long time to converge, and it is not guaranteed that it will converge. It may show the same parameters for some first iterations, and then suddenly change the parameters. So you need to be patient and check the results carefully.</p>
</div>
<p>I tried the tidal tail feature, but it crashes… I am not sure why.</p>
<p>So I tried the fitting without the tidal tail.
It converged and its <span class="math notranslate nohighlight">\(\chi^2_\nu=5.5\)</span> is reasonably small.</p>
<p>Fitting the spiral galaxy with galfit is very tough!
You need to select which components will describe the target galaxy best and
carefully set the initial guess of the parameters…</p>
</section>
<section id="evaluating-the-fit">
<h2>3. Evaluating the Fit<a class="headerlink" href="#evaluating-the-fit" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rhdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">cwd</span><span class="o">/</span><span class="n">DIR_OUTPUT</span><span class="o">/</span><span class="sa">f</span><span class="s2">&quot;block_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">-r.fits&quot;</span><span class="p">)</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">rhdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">mod</span> <span class="o">=</span> <span class="n">rhdu</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">rhdu</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># Plot the result</span>
<span class="n">inorm</span> <span class="o">=</span> <span class="n">ImageNormalize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">AsymmetricPercentileInterval</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">99.0</span><span class="p">),</span> <span class="n">stretch</span><span class="o">=</span><span class="n">AsinhStretch</span><span class="p">())</span>
<span class="n">mnorm</span> <span class="o">=</span> <span class="n">ImageNormalize</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">AsymmetricPercentileInterval</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">99.0</span><span class="p">),</span> <span class="n">stretch</span><span class="o">=</span><span class="n">AsinhStretch</span><span class="p">())</span>
<span class="n">rnorm</span> <span class="o">=</span> <span class="n">ImageNormalize</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">AsymmetricPercentileInterval</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">99.0</span><span class="p">),</span> <span class="n">stretch</span><span class="o">=</span><span class="n">AsinhStretch</span><span class="p">())</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">inorm</span><span class="p">)</span>
<span class="n">mm</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">inorm</span><span class="p">)</span>
<span class="n">rm</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">inorm</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Input image&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Model image&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Residual image&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
    <span class="n">a</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/10cbac2ef3544a0f37a70a047b3af1570b9d439fe355e93085353004bf7ffd21.png"><img alt="../_images/10cbac2ef3544a0f37a70a047b3af1570b9d439fe355e93085353004bf7ffd21.png" class="align-center" src="../_images/10cbac2ef3544a0f37a70a047b3af1570b9d439fe355e93085353004bf7ffd21.png" style="width: 980px; height: 352px;" />
</a>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">photutils.aperture</span> <span class="kn">import</span> <span class="n">CircularAnnulus</span><span class="p">,</span> <span class="n">aperture_photometry</span><span class="p">,</span> <span class="n">ApertureStats</span>

<span class="kn">from</span> <span class="nn">photutils.isophote</span> <span class="kn">import</span> <span class="n">EllipseGeometry</span>
<span class="kn">from</span> <span class="nn">photutils.isophote</span> <span class="kn">import</span> <span class="n">Ellipse</span>

<span class="n">r_e</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rhdu</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;3_RE&#39;</span><span class="p">][:</span><span class="mi">7</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r_e</span><span class="p">)</span>

<span class="n">ehdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">cwd</span><span class="o">/</span><span class="n">DIR_INPUT</span><span class="o">/</span><span class="sa">f</span><span class="s2">&quot;sigma_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">-r.fits&quot;</span><span class="p">)</span>
<span class="n">eimg</span> <span class="o">=</span> <span class="n">ehdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

<span class="n">ann</span> <span class="o">=</span> <span class="n">CircularAnnulus</span><span class="p">((</span><span class="n">x_a</span><span class="p">,</span> <span class="n">y_a</span><span class="p">),</span> <span class="n">r_in</span><span class="o">=</span><span class="n">r_e</span><span class="p">,</span> <span class="n">r_out</span><span class="o">=</span><span class="n">r_e</span><span class="o">+</span><span class="n">r_e</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span>
<span class="n">ptab</span> <span class="o">=</span> <span class="n">aperture_photometry</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">ann</span><span class="p">)</span>
<span class="n">astat</span> <span class="o">=</span> <span class="n">ApertureStats</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">ann</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">eimg</span><span class="p">)</span>
<span class="n">astat</span><span class="o">.</span><span class="n">to_table</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>415.519
</pre></div>
</div>
<div class="output text_html"><div><i>QTable length=1</i>
<table id="table140370272003712" class="table-striped table-bordered table-condensed">
<thead><tr><th>id</th><th>xcentroid</th><th>ycentroid</th><th>sky_centroid</th><th>sum</th><th>sum_err</th><th>sum_aper_area</th><th>center_aper_area</th><th>min</th><th>max</th><th>mean</th><th>median</th><th>mode</th><th>std</th><th>mad_std</th><th>var</th><th>biweight_location</th><th>biweight_midvariance</th><th>fwhm</th><th>semimajor_sigma</th><th>semiminor_sigma</th><th>orientation</th><th>eccentricity</th></tr></thead>
<thead><tr><th></th><th></th><th></th><th></th><th></th><th></th><th>pix2</th><th>pix2</th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th>pix</th><th>pix</th><th>pix</th><th>deg</th><th></th></tr></thead>
<thead><tr><th>int64</th><th>float64</th><th>float64</th><th>object</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>1</td><td>1179.7744549906656</td><td>1013.375021812803</td><td>None</td><td>30293.330702551862</td><td>9.96913814243584</td><td>113907.13841942974</td><td>113896.0</td><td>-0.011959891766309738</td><td>51.8526496887207</td><td>0.26595197190906444</td><td>0.2565868943929672</td><td>0.23785673936077278</td><td>0.4181465178505515</td><td>0.13795405321574528</td><td>0.1748465103905416</td><td>0.25196249655561587</td><td>0.015597976063318315</td><td>715.9875134342707</td><td>337.7763582994452</td><td>266.0869217548677</td><td>-51.391266086358776</td><td>0.6159814662565373</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">inorm</span><span class="p">)</span>
<span class="n">ann</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;matplotlib.patches.PathPatch at 0x7faa612311e0&gt;,)
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/12129de8a412a845d8705d36684146c2bc35ef9de614fb05f020745fdfa660d9.png"><img alt="../_images/12129de8a412a845d8705d36684146c2bc35ef9de614fb05f020745fdfa660d9.png" class="align-center" src="../_images/12129de8a412a845d8705d36684146c2bc35ef9de614fb05f020745fdfa660d9.png" style="width: 460px; height: 431px;" />
</a>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ZP</span> <span class="o">=</span> <span class="mf">22.5</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">0.08</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="n">SCALE</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">20.0</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="n">SCALE</span><span class="p">),</span> <span class="mi">40</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">inorm</span><span class="p">)</span>
<span class="n">mu</span><span class="p">,</span> <span class="n">muerr</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">mu_mod</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">astats</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">ann</span> <span class="o">=</span> <span class="n">CircularAnnulus</span><span class="p">((</span><span class="n">x_a</span><span class="p">,</span> <span class="n">y_a</span><span class="p">),</span> <span class="n">r_in</span><span class="o">=</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">r_out</span><span class="o">=</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ann</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    
    <span class="n">astat</span> <span class="o">=</span> <span class="n">ApertureStats</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">ann</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">eimg</span><span class="p">)</span>
    <span class="n">_mu</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">astat</span><span class="o">.</span><span class="n">median</span><span class="p">)</span> <span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">SCALE</span><span class="p">)</span> <span class="o">+</span> <span class="n">ZP</span> <span class="c1"># [mag/arcsec^2]</span>
    <span class="n">_ferr</span> <span class="o">=</span> <span class="n">astat</span><span class="o">.</span><span class="n">std</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">astat</span><span class="o">.</span><span class="n">sum_aper_area</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">/</span><span class="n">SCALE</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># [nmgy/arcsec^2]</span>
    <span class="n">_muerr</span> <span class="o">=</span> <span class="mf">2.5</span><span class="o">*</span><span class="n">_ferr</span><span class="o">/</span><span class="n">astat</span><span class="o">.</span><span class="n">median</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">((</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="o">/</span><span class="mi">60</span><span class="o">*</span><span class="n">SCALE</span><span class="p">,</span> <span class="n">_mu</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">_muerr</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    
    <span class="n">astat_mod</span> <span class="o">=</span> <span class="n">ApertureStats</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">ann</span><span class="p">)</span>
    <span class="n">_mu_mod</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">astat_mod</span><span class="o">.</span><span class="n">median</span><span class="p">)</span> <span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">SCALE</span><span class="p">)</span> <span class="o">+</span> <span class="n">ZP</span> <span class="c1"># [mag/arcsec^2]</span>
    
    <span class="n">mu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_mu</span><span class="p">)</span>
    <span class="n">muerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_muerr</span><span class="p">)</span>
    <span class="n">mu_mod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_mu_mod</span><span class="p">)</span>
    <span class="n">astats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">astat</span><span class="p">)</span>
    
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Radius [arcmin]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mu_{{\rm SDSS} r}$ [mag/arcsec$^2$]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">r</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="mi">60</span><span class="o">*</span><span class="n">SCALE</span><span class="p">,</span> <span class="n">mu_mod</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
    
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/49bc5abce41c02b0dc6f56b7892938ed9da480fc9779478e495efae665e2791f.png"><img alt="../_images/49bc5abce41c02b0dc6f56b7892938ed9da480fc9779478e495efae665e2791f.png" class="align-center" src="../_images/49bc5abce41c02b0dc6f56b7892938ed9da480fc9779478e495efae665e2791f.png" style="width: 777px; height: 377px;" />
</a>
</div>
</div>
</section>
<section id="usefull-references">
<h2>Usefull References<a class="headerlink" href="#usefull-references" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://photutils.readthedocs.io/en/stable/aperture.html">Aperture Photometry</a></p></li>
<li><p><a class="reference external" href="https://photutils.readthedocs.io/en/stable/isophote.html">Elliptical Isophote Analysis</a></p></li>
</ul>
</section>
<section id="simple-galfit-run">
<h2>Simple GALFIT Run<a class="headerlink" href="#simple-galfit-run" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="https://github.com/hbahk/TAO23/tree/main/tutorials/data/proj4/example">Visit here</a>
to get simple GALFIT run examples, which are made by Dr. Jeong Hwan Lee.</p>
<p><img alt="" src="../_images/Thumbnails.png" /></p>
</section>
<section id="to-obtain-psf-from-sdss-sas">
<h2>To Obtain PSF from SDSS SAS<a class="headerlink" href="#to-obtain-psf-from-sdss-sas" title="Link to this heading">#</a></h2>
<p>Follow description of <a class="reference external" href="https://data.sdss.org//datamodel/files/PHOTO_REDUX/RERUN/RUN/objcs/CAMCOL/psField.html">Data model: psField</a> and <a class="reference external" href="https://www.sdss4.org/dr16/algorithms/read_psf/">Extracting PSF Images</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">AsymmetricPercentileInterval</span><span class="p">,</span> <span class="n">AsinhStretch</span><span class="p">,</span> <span class="n">ImageNormalize</span>


<span class="k">def</span> <span class="nf">reconstructPSF</span><span class="p">(</span><span class="n">psFieldFilename</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>

    <span class="n">filterIdx</span> <span class="o">=</span> <span class="s1">&#39;ugriz&#39;</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">psField</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">psFieldFilename</span><span class="p">)</span>
    <span class="n">pStruct</span> <span class="o">=</span> <span class="n">psField</span><span class="p">[</span><span class="n">filterIdx</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

    <span class="n">nrow_b</span> <span class="o">=</span> <span class="n">pStruct</span><span class="p">[</span><span class="s1">&#39;nrow_b&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ncol_b</span> <span class="o">=</span> <span class="n">pStruct</span><span class="p">[</span><span class="s1">&#39;ncol_b&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">rnrow</span> <span class="o">=</span> <span class="n">pStruct</span><span class="p">[</span><span class="s1">&#39;rnrow&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rncol</span> <span class="o">=</span> <span class="n">pStruct</span><span class="p">[</span><span class="s1">&#39;rncol&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">nb</span> <span class="o">=</span> <span class="n">nrow_b</span> <span class="o">*</span> <span class="n">ncol_b</span>
    <span class="n">coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nb</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">ecoeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">cmat</span> <span class="o">=</span> <span class="n">pStruct</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>

    <span class="n">rcs</span> <span class="o">=</span> <span class="mf">0.001</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nb</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="n">coeffs</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span> <span class="o">*</span> <span class="n">rcs</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">ii</span> <span class="o">%</span> <span class="n">nrow_b</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">col</span> <span class="o">*</span> <span class="n">rcs</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">ii</span> <span class="o">/</span> <span class="n">nrow_b</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nb</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="n">ecoeff</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">ecoeff</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="o">+</span> <span class="n">cmat</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ii</span> <span class="o">/</span> <span class="n">nrow_b</span><span class="p">),</span> <span class="n">ii</span> <span class="o">%</span> <span class="n">nrow_b</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeffs</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>

    <span class="n">psf</span> <span class="o">=</span> <span class="n">pStruct</span><span class="p">[</span><span class="s1">&#39;rrows&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ecoeff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> \
        <span class="n">pStruct</span><span class="p">[</span><span class="s1">&#39;rrows&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ecoeff</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> \
        <span class="n">pStruct</span><span class="p">[</span><span class="s1">&#39;rrows&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ecoeff</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">psf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">psf</span><span class="p">,</span> <span class="p">(</span><span class="n">rnrow</span><span class="p">,</span> <span class="n">rncol</span><span class="p">))</span>
    <span class="c1"># psf = psf[10:40, 10:40]  # Trim non-zero regions.</span>

    <span class="k">return</span> <span class="n">psf</span>

<span class="c1"># for a given SDSS frame</span>
<span class="n">fhdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;frame-r-003699-6-0100.fits&#39;</span><span class="p">)</span>
<span class="n">rerun</span> <span class="o">=</span> <span class="n">fhdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;RERUN&#39;</span><span class="p">]</span>
<span class="n">run</span> <span class="o">=</span> <span class="n">fhdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;RUN&#39;</span><span class="p">]</span>
<span class="n">camcol</span> <span class="o">=</span> <span class="n">fhdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CAMCOL&#39;</span><span class="p">]</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">fhdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FRAME&#39;</span><span class="p">]</span>
<span class="n">ps_url</span> <span class="o">=</span> <span class="s1">&#39;https://data.sdss.org/sas/dr17/eboss/photo/redux/&#39;</span> <span class="o">+</span> \
         <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rerun</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">run</span><span class="si">}</span><span class="s1">/objcs/</span><span class="si">{</span><span class="n">camcol</span><span class="si">}</span><span class="s1">/psField-</span><span class="si">{</span><span class="n">run</span><span class="si">:</span><span class="s1">06d</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">camcol</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">frame</span><span class="si">:</span><span class="s1">04d</span><span class="si">}</span><span class="s1">.fit&#39;</span>

<span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">fhdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CRPIX2&#39;</span><span class="p">],</span> <span class="n">fhdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CRPIX1&#39;</span><span class="p">]</span> <span class="c1"># PSF at the image center</span>
<span class="n">psf</span> <span class="o">=</span> <span class="n">reconstructPSF</span><span class="p">(</span><span class="n">ps_url</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">pnorm</span> <span class="o">=</span> <span class="n">ImageNormalize</span><span class="p">(</span><span class="n">psf</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">AsymmetricPercentileInterval</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">99.</span><span class="p">),</span> <span class="n">stretch</span><span class="o">=</span><span class="n">AsinhStretch</span><span class="p">())</span>
<span class="n">pim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">psf</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">pnorm</span><span class="p">)</span>
<span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pim</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7faa51b95270&gt;
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/05b17ded4fccc456355f5d58bbcab8462ae64069506a08657d6f21edd13df6a6.png"><img alt="../_images/05b17ded4fccc456355f5d58bbcab8462ae64069506a08657d6f21edd13df6a6.png" class="align-center" src="../_images/05b17ded4fccc456355f5d58bbcab8462ae64069506a08657d6f21edd13df6a6.png" style="width: 501px; height: 414px;" />
</a>
</div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="data/proj3/run_SExtractor.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">SExtractor Photometry of MACS 0717</p>
      </div>
    </a>
    <a class="right-next"
       href="Spectroscopic_data_reduction.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Spectroscopic Data Reduction</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-galfit">0. Install GALFIT</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-the-input-data">1. Prepare the Input Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-sdss-mosaic-image-from-sdss-science-archive-server-sas">Download SDSS Mosaic Image from SDSS Science Archive Server (SAS)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#m51">M51</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-psf">Getting PSF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#making-the-mask-image">Making the Mask Image</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initialize-model-and-run-galfit">2. Initialize Model and Run GALFIT</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluating-the-fit">3. Evaluating the Fit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#usefull-references">Usefull References</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-galfit-run">Simple GALFIT Run</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#to-obtain-psf-from-sdss-sas">To Obtain PSF from SDSS SAS</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Hyeonguk Bahk
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, Hyeonguk Bahk.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>