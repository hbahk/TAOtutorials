
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Spectroscopic Data Reduction &#8212; TAO Tutorials  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=3c32ad28" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/Spectroscopic_data_reduction';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Project 5: Spectroscopic Data Analysis" href="Proj5_Spectroscopic_Data_Analysis.html" />
    <link rel="prev" title="Surface Photometry Using GALFIT" href="GALFIT-Surface_Photometry.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">TAO Tutorials</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">SNU TAO Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Preparation.html">Preparation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Project Tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="PSF_photometry.html">PSF photometry of NGC 2210</a></li>
<li class="toctree-l1"><a class="reference internal" href="data/proj3/run_SExtractor.html">SExtractor Photometry of MACS 0717</a></li>
<li class="toctree-l1"><a class="reference internal" href="GALFIT-Surface_Photometry.html">Surface Photometry Using GALFIT</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Spectroscopic Data Reduction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Projects</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Proj5_Spectroscopic_Data_Analysis.html">Project 5: Spectroscopic Data Analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Additional Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Preprocessing.html">Preprocessing the CCD images</a></li>
<li class="toctree-l1"><a class="reference internal" href="SAO-Spectroscopic-Data-Reduction.html">Concept of spectroscopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="Optical%20Spectroscopy.html">Specutils: An Astropy package for spectroscopy</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/hbahk/TAOTutorials" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/tutorials/Spectroscopic_data_reduction.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Spectroscopic Data Reduction</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-of-the-raw-images">Preprocessing of the Raw Images</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#making-the-master-bias">Making the Master Bias</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#making-master-flat">Making Master Flat</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-for-flat-image-shift">Checking for Flat Image Shift</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-with-the-standard-star-profile">Comparing with the Standard Star Profile</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-the-raw-images">Preprocessing the Raw Images</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-1d-spectra">Extracting 1D Spectra</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="spectroscopic-data-reduction">
<h1>Spectroscopic Data Reduction<a class="headerlink" href="#spectroscopic-data-reduction" title="Link to this heading">#</a></h1>
<p>Spectroscopic data reduction is the process of converting raw spectroscopic images from a spectrograph into a calibrated spectrum. This process involves several steps, including bias subtraction, flat fielding, wavelength calibration, and extraction of the spectrum. In this notebook, we will go through the process of reducing a spectroscopic image using Python.</p>
<p>The CCD pre-processing steps are as usual: bias/dark subtraction, flat fielding, and cosmic ray removal. The spectroscopic data reduction steps are: extraction of the spectrum, wavelength calibration and flux calibration. Here we will focus mostly on the spectroscopic data reduction steps. After the data reduction, the spectrum can be used for scientific analysis, such as measuring redshifts, line identifications, and measuring line fluxes. In this notebook, we will reduce a 2D spectrum of an afterglow of a gamma-ray burst (GRB). Since this tutorial is prepared for the <a class="reference external" href="https://hbahk.github.io/TAOtutorials/tutorials/Proj5_Spectroscopic_Data_Analysis">Project No. 5 of our TAO class</a>, I leave the scientific analysis of the spectrum to readers.</p>
<p>The data used in this notebook is from the Subaru Telescope’s Faint Object Camera and Spectrograph (FOCAS). The data is 2D images of a spectrum of an afterglow of a GRB, GRB 130606A, which is a significantly redshifted source at <span class="math notranslate nohighlight">\(z\sim5.9\)</span>. The data was taken on June 7, 2013, using the VPH900 grism, which covers the wavelength range of 7500-10450 Angstroms (<a class="reference external" href="https://www.naoj.org/Observing/Instruments/FOCAS/index.html">Subaru FOCAS Hompage</a>).</p>
<p>Let’s start by organizing the data and displaying the 2D spectral images.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">ascii</span><span class="p">,</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span><span class="n">Column</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">median_filter</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">UnivariateSpline</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="nn">skimage.feature</span> <span class="kn">import</span> <span class="n">peak_local_max</span>
<span class="kn">from</span> <span class="nn">astropy.stats</span> <span class="kn">import</span> <span class="n">sigma_clip</span><span class="p">,</span> <span class="n">gaussian_fwhm_to_sigma</span>
<span class="kn">from</span> <span class="nn">numpy.polynomial.chebyshev</span> <span class="kn">import</span> <span class="n">chebfit</span><span class="p">,</span> <span class="n">chebval</span>
<span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">CCDData</span>
<span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="kn">import</span> <span class="n">Gaussian1D</span><span class="p">,</span> <span class="n">Chebyshev2D</span>
<span class="kn">from</span> <span class="nn">astropy.modeling.fitting</span> <span class="kn">import</span> <span class="n">LevMarLSQFitter</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">ZScaleInterval</span>
<span class="kn">from</span> <span class="nn">ccdproc</span> <span class="kn">import</span> <span class="n">combine</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">gridspec</span><span class="p">,</span> <span class="n">rcParams</span><span class="p">,</span> <span class="n">rc</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">preproc</span> <span class="c1"># custom module for data reduction</span>

<span class="c1"># plt.rcParams[&#39;axes.linewidth&#39;] = 2</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>

<span class="n">WD</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./data/proj5&#39;</span><span class="p">)</span>
<span class="n">RAWDIR</span> <span class="o">=</span> <span class="n">WD</span> <span class="o">/</span> <span class="s1">&#39;raw&#39;</span> <span class="o">/</span> <span class="s1">&#39;P03hbahk0304145443GZ_data&#39;</span>
<span class="n">OUTDIR</span> <span class="o">=</span> <span class="n">WD</span> <span class="o">/</span> <span class="s1">&#39;out&#39;</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">OUTDIR</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">OUTDIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_summary_table_focas</span><span class="p">(</span><span class="n">rawdir</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.fits.gz&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make a summary table of the raw data in the directory. This function is</span>
<span class="sd">    specifically designed for the data taken with the FOCAS instrument.</span>

<span class="sd">    Args:</span>
<span class="sd">        rawdir (pathlib.Path): The directory containing the raw data.</span>
<span class="sd">        suffix (str, optional): The suffix of the raw data files. Defaults to</span>
<span class="sd">            &#39;.fits.gz&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        stab (astropy.table.Table): The summary table of the raw data in the directory.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># making a summary table</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">rawdir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">+</span><span class="n">suffix</span><span class="p">):</span>
        <span class="n">hdr</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        
        <span class="c1"># getting the filter information from the header</span>
        <span class="n">filt1</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;FILTER01&#39;</span><span class="p">]</span>
        <span class="n">filt2</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;FILTER02&#39;</span><span class="p">]</span>
        <span class="n">filt3</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;FILTER03&#39;</span><span class="p">]</span>
            
        <span class="n">X</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;AIRMASS&#39;</span><span class="p">]</span> <span class="c1"># airmass</span>
        <span class="n">disp</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;DISPERSR&#39;</span><span class="p">]</span> <span class="c1"># disperser</span>
        
        <span class="c1"># appending the data to the summary list</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;DATE-OBS&#39;</span><span class="p">],</span> <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">],</span> <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;RA&#39;</span><span class="p">],</span> <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;DEC&#39;</span><span class="p">],</span>
                        <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;DATA-TYP&#39;</span><span class="p">],</span> <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;EXPTIME&#39;</span><span class="p">],</span> <span class="n">X</span><span class="p">,</span> <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;ALTITUDE&#39;</span><span class="p">],</span> <span class="n">disp</span><span class="p">,</span>
                        <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;SLT-WID&#39;</span><span class="p">],</span> <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;SLT-PA&#39;</span><span class="p">],</span> <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;SLIT&#39;</span><span class="p">],</span> <span class="n">filt1</span><span class="p">,</span> <span class="n">filt2</span><span class="p">,</span> <span class="n">filt3</span><span class="p">,</span>
                        <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;UT-STR&#39;</span><span class="p">],</span> <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;UT-END&#39;</span><span class="p">]])</span>
        
    <span class="c1"># creating the summary table</span>
    <span class="n">stab</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="n">summary</span><span class="p">,</span>
                 <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;date-obs&#39;</span><span class="p">,</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;ra&#39;</span><span class="p">,</span> <span class="s1">&#39;dec&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;exptime&#39;</span><span class="p">,</span> <span class="s1">&#39;airmass&#39;</span><span class="p">,</span> <span class="s1">&#39;altitude&#39;</span><span class="p">,</span> <span class="s1">&#39;disperser&#39;</span><span class="p">,</span> <span class="s1">&#39;slit-width&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;slit-pa&#39;</span><span class="p">,</span> <span class="s1">&#39;slit&#39;</span><span class="p">,</span> <span class="s1">&#39;filter1&#39;</span><span class="p">,</span> <span class="s1">&#39;filter2&#39;</span><span class="p">,</span><span class="s1">&#39;filter3&#39;</span><span class="p">,</span> <span class="s1">&#39;ut-str&#39;</span><span class="p">,</span> <span class="s1">&#39;ut-end&#39;</span><span class="p">],</span>
                 <span class="n">dtype</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;U50&#39;</span><span class="p">,</span> <span class="s1">&#39;U50&#39;</span><span class="p">,</span> <span class="s1">&#39;U50&#39;</span><span class="p">,</span> <span class="s1">&#39;U50&#39;</span><span class="p">,</span> <span class="s1">&#39;U50&#39;</span><span class="p">,</span> <span class="s1">&#39;U50&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;U50&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="s1">&#39;U50&#39;</span><span class="p">,</span> <span class="s1">&#39;U50&#39;</span><span class="p">,</span> <span class="s1">&#39;U50&#39;</span><span class="p">,</span> <span class="s1">&#39;U50&#39;</span><span class="p">,</span> <span class="s1">&#39;U50&#39;</span><span class="p">,</span> <span class="s1">&#39;U50&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">stab</span>

<span class="n">summary_table</span> <span class="o">=</span> <span class="n">make_summary_table_focas</span><span class="p">(</span><span class="n">RAWDIR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">summary_table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=60</i>
<table id="table4594558160" class="table-striped table-bordered table-condensed">
<thead><tr><th>filename</th><th>date-obs</th><th>object</th><th>ra</th><th>dec</th><th>type</th><th>exptime</th><th>airmass</th><th>altitude</th><th>disperser</th><th>slit-width</th><th>slit-pa</th><th>slit</th><th>filter1</th><th>filter2</th><th>filter3</th><th>ut-str</th><th>ut-end</th></tr></thead>
<thead><tr><th>str50</th><th>str50</th><th>str50</th><th>str50</th><th>str50</th><th>str50</th><th>float64</th><th>float64</th><th>float64</th><th>str50</th><th>float64</th><th>float64</th><th>str50</th><th>str50</th><th>str50</th><th>str50</th><th>str50</th><th>str50</th></tr></thead>
<tr><td>FCSA00141794.fits.gz</td><td>2013-06-07</td><td>DOMEFLAT</td><td>11:17:48.038</td><td>+19:54:08.26</td><td>DOMEFLAT</td><td>3.0</td><td>1.0</td><td>89.9361</td><td>SCFCGRHD90</td><td>0.5</td><td>-90.3</td><td>SCFCSLLC08</td><td>NONE</td><td>SCFCFLSO58</td><td>NONE</td><td>04:37:11.906</td><td>04:37:15.139</td></tr>
<tr><td>FCSA00141920.fits.gz</td><td>2013-06-07</td><td>GRB 130606A</td><td>16:37:41.157</td><td>+29:47:45.71</td><td>OBJECT</td><td>1200.0</td><td>1.136</td><td>61.6129</td><td>SCFCGRHD90</td><td>0.5</td><td>-90.3</td><td>SCFCSLLC08</td><td>NONE</td><td>SCFCFLSO58</td><td>NONE</td><td>07:59:00.676</td><td>08:19:01.117</td></tr>
<tr><td>FCSA00141930.fits.gz</td><td>2013-06-07</td><td>GRB 130606A</td><td>16:37:41.230</td><td>+29:47:45.13</td><td>OBJECT</td><td>1200.0</td><td>1.038</td><td>74.4191</td><td>SCFCGRHD90</td><td>0.5</td><td>-90.3</td><td>SCFCSLLC08</td><td>NONE</td><td>SCFCFLSO58</td><td>NONE</td><td>09:03:28.980</td><td>09:23:29.405</td></tr>
<tr><td>FCSA00141848.fits.gz</td><td>2013-06-07</td><td>BIAS</td><td>11:39:50.841</td><td>+19:54:11.18</td><td>BIAS</td><td>0.0</td><td>1.0</td><td>89.9361</td><td>SCFCGRMR01</td><td>0.5</td><td>-90.3</td><td>SCFCSLLC20</td><td>NONE</td><td>SCFCFLSO58</td><td>NONE</td><td>04:59:10.571</td><td>04:59:10.574</td></tr>
<tr><td>FCSA00141916.fits.gz</td><td>2013-06-07</td><td>GRB 130606A</td><td>16:37:41.020</td><td>+29:47:44.75</td><td>OBJECT</td><td>1200.0</td><td>1.254</td><td>52.8249</td><td>SCFCGRHD90</td><td>0.5</td><td>-90.3</td><td>SCFCSLLC08</td><td>NONE</td><td>SCFCFLSO58</td><td>NONE</td><td>07:18:00.165</td><td>07:38:00.608</td></tr>
<tr><td>FCSA00141734.fits.gz</td><td>2013-06-06</td><td>BIAS</td><td>21:41:03.767</td><td>+17:46:28.41</td><td>BIAS</td><td>0.0</td><td>1.001</td><td>86.8997</td><td>SCFCGRHD90</td><td>0.5</td><td>-0.3</td><td>SCFCSLLC20</td><td>NONE</td><td>SCFCFLSO58</td><td>NONE</td><td>14:53:03.807</td><td>14:53:03.810</td></tr>
<tr><td>FCSA00141566.fits.gz</td><td>2013-06-06</td><td>DOMEFLAT</td><td>11:23:03.374</td><td>+19:54:09.25</td><td>DOMEFLAT</td><td>1.1</td><td>1.0</td><td>89.9625</td><td>SCFCGRHD90</td><td>0.5</td><td>-90.3</td><td>SCFCSLLC20</td><td>NONE</td><td>SCFCFLSO58</td><td>NONE</td><td>04:46:28.971</td><td>04:46:30.721</td></tr>
<tr><td>FCSA00141576.fits.gz</td><td>2013-06-06</td><td>DOMEFLAT</td><td>11:26:18.779</td><td>+19:54:09.76</td><td>DOMEFLAT</td><td>3.0</td><td>1.0</td><td>89.9625</td><td>SCFCGRHD90</td><td>0.5</td><td>-90.3</td><td>SCFCSLLC08</td><td>NONE</td><td>SCFCFLSO58</td><td>NONE</td><td>04:49:43.639</td><td>04:49:46.993</td></tr>
<tr><td>FCSA00141822.fits.gz</td><td>2013-06-07</td><td>DOMEFLAT</td><td>11:26:05.681</td><td>+19:54:09.65</td><td>DOMEFLAT</td><td>1.1</td><td>1.0</td><td>89.9361</td><td>SCFCGRHD90</td><td>0.5</td><td>-90.3</td><td>SCFCSLLC20</td><td>NONE</td><td>SCFCFLSO58</td><td>NONE</td><td>04:45:27.990</td><td>04:45:29.664</td></tr>
<tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
<tr><td>FCSA00141730.fits.gz</td><td>2013-06-06</td><td>BIAS</td><td>23:03:44.623</td><td>-01:20:01.29</td><td>BIAS</td><td>0.0</td><td>1.169</td><td>58.8068</td><td>SCFCGRHD90</td><td>0.5</td><td>-0.3</td><td>SCFCSLLC20</td><td>NONE</td><td>SCFCFLSO58</td><td>NONE</td><td>14:52:13.406</td><td>14:52:13.410</td></tr>
<tr><td>FCSA00141818.fits.gz</td><td>2013-06-07</td><td>DOMEFLAT</td><td>11:25:08.002</td><td>+19:54:09.51</td><td>DOMEFLAT</td><td>1.1</td><td>1.0</td><td>89.9361</td><td>SCFCGRHD90</td><td>0.5</td><td>-90.3</td><td>SCFCSLLC20</td><td>NONE</td><td>SCFCFLSO58</td><td>NONE</td><td>04:44:30.393</td><td>04:44:31.697</td></tr>
<tr><td>FCSA00142010.fits.gz</td><td>2013-06-07</td><td>Feige110</td><td>23:20:01.964</td><td>-05:10:51.68</td><td>OBJECT</td><td>120.0</td><td>1.208</td><td>55.8712</td><td>SCFCGRHD90</td><td>0.5</td><td>-405.3</td><td>SCFCSLLC20</td><td>NONE</td><td>SCFCFLSO58</td><td>NONE</td><td>15:03:10.694</td><td>15:05:11.030</td></tr>
<tr><td>FCSA00141798.fits.gz</td><td>2013-06-07</td><td>DOMEFLAT</td><td>11:18:59.560</td><td>+19:54:08.48</td><td>DOMEFLAT</td><td>3.0</td><td>1.0</td><td>89.9361</td><td>SCFCGRHD90</td><td>0.5</td><td>-90.3</td><td>SCFCSLLC08</td><td>NONE</td><td>SCFCFLSO58</td><td>NONE</td><td>04:38:23.184</td><td>04:38:26.574</td></tr>
<tr><td>FCSA00141854.fits.gz</td><td>2013-06-07</td><td>BIAS</td><td>11:41:06.075</td><td>+19:54:11.27</td><td>BIAS</td><td>0.0</td><td>1.0</td><td>89.9361</td><td>SCFCGRMR01</td><td>0.5</td><td>-90.3</td><td>SCFCSLLC20</td><td>NONE</td><td>SCFCFLSO58</td><td>NONE</td><td>05:00:25.637</td><td>05:00:25.674</td></tr>
<tr><td>FCSA00141586.fits.gz</td><td>2013-06-06</td><td>BIAS</td><td>11:32:20.002</td><td>+19:54:10.54</td><td>BIAS</td><td>0.0</td><td>1.0</td><td>89.9625</td><td>SCFCGRHD90</td><td>0.5</td><td>-90.3</td><td>SCFCSLLC20</td><td>NONE</td><td>SCFCFLSO58</td><td>NONE</td><td>04:55:43.880</td><td>04:55:43.883</td></tr>
<tr><td>FCSA00141562.fits.gz</td><td>2013-06-06</td><td>DOMEFLAT</td><td>11:22:06.397</td><td>+19:54:09.10</td><td>DOMEFLAT</td><td>1.1</td><td>1.0</td><td>89.9625</td><td>SCFCGRHD90</td><td>0.5</td><td>-90.3</td><td>SCFCSLLC20</td><td>NONE</td><td>SCFCFLSO58</td><td>NONE</td><td>04:45:32.080</td><td>04:45:33.717</td></tr>
<tr><td>FCSA00141572.fits.gz</td><td>2013-06-06</td><td>DOMEFLAT</td><td>11:25:16.188</td><td>+19:54:09.60</td><td>DOMEFLAT</td><td>3.0</td><td>1.0</td><td>89.9625</td><td>SCFCGRHD90</td><td>0.5</td><td>-90.3</td><td>SCFCSLLC08</td><td>NONE</td><td>SCFCFLSO58</td><td>NONE</td><td>04:48:41.382</td><td>04:48:44.710</td></tr>
<tr><td>FCSA00141728.fits.gz</td><td>2013-06-06</td><td>BIAS</td><td>23:19:58.381</td><td>-05:11:14.89</td><td>BIAS</td><td>0.0</td><td>1.248</td><td>53.1982</td><td>SCFCGRHD90</td><td>0.5</td><td>-0.3</td><td>SCFCSLLC20</td><td>NONE</td><td>SCFCFLSO58</td><td>NONE</td><td>14:51:48.193</td><td>14:51:48.197</td></tr>
<tr><td>FCSA00141800.fits.gz</td><td>2013-06-07</td><td>DOMEFLAT</td><td>11:19:30.656</td><td>+19:54:08.58</td><td>DOMEFLAT</td><td>3.0</td><td>1.0</td><td>89.9361</td><td>SCFCGRHD90</td><td>0.5</td><td>-90.3</td><td>SCFCSLLC08</td><td>NONE</td><td>SCFCFLSO58</td><td>NONE</td><td>04:38:54.202</td><td>04:38:57.612</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">biastab</span> <span class="o">=</span> <span class="n">summary_table</span><span class="p">[</span><span class="n">summary_table</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;BIAS&#39;</span><span class="p">]</span>
<span class="n">flattab</span> <span class="o">=</span> <span class="n">summary_table</span><span class="p">[</span><span class="n">summary_table</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;DOMEFLAT&#39;</span><span class="p">]</span>
<span class="n">arctab</span> <span class="o">=</span> <span class="n">summary_table</span><span class="p">[(</span><span class="n">summary_table</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;COMPARISON&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
                       <span class="p">(</span><span class="n">summary_table</span><span class="p">[</span><span class="s1">&#39;slit&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SCFCSLLC08&#39;</span><span class="p">)]</span>
<span class="n">scitab</span> <span class="o">=</span> <span class="n">summary_table</span><span class="p">[</span><span class="n">summary_table</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;GRB 130606A&#39;</span><span class="p">]</span>
<span class="n">stdtab_f110</span> <span class="o">=</span> <span class="n">summary_table</span><span class="p">[(</span><span class="n">summary_table</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Feige110&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
                            <span class="p">(</span><span class="n">summary_table</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;OBJECT&#39;</span><span class="p">)]</span>
<span class="n">stdtab_f34</span> <span class="o">=</span> <span class="n">summary_table</span><span class="p">[(</span><span class="n">summary_table</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Feige34&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
                            <span class="p">(</span><span class="n">summary_table</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;OBJECT&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for displaying in zscale</span>
<span class="n">interval</span> <span class="o">=</span> <span class="n">ZScaleInterval</span><span class="p">()</span>

<span class="c1"># plotting the images</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Bias&#39;</span><span class="p">,</span> <span class="s1">&#39;Flat&#39;</span><span class="p">,</span> <span class="s1">&#39;Arc&#39;</span><span class="p">,</span> <span class="s1">&#39;Sci&#39;</span><span class="p">]</span>
<span class="n">bias</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">RAWDIR</span> <span class="o">/</span> <span class="n">biastab</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="n">flat</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">RAWDIR</span> <span class="o">/</span> <span class="n">flattab</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="n">arc</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">RAWDIR</span> <span class="o">/</span> <span class="n">arctab</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sci</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">RAWDIR</span> <span class="o">/</span> <span class="n">scitab</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">bias</span><span class="p">,</span> <span class="n">flat</span><span class="p">,</span> <span class="n">arc</span><span class="p">,</span> <span class="n">sci</span><span class="p">]):</span>
    <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">interval</span><span class="o">.</span><span class="n">get_limits</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span> <span class="o">//</span> <span class="mi">2</span><span class="p">][</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
            <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="k">del</span> <span class="n">bias</span><span class="p">,</span> <span class="n">flat</span><span class="p">,</span> <span class="n">arc</span><span class="p">,</span> <span class="n">sci</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6b647f7859f0dd31069988cfc76ed8e76465206e7ca9550de42bc432039edc4e.png" class="align-center" src="../_images/6b647f7859f0dd31069988cfc76ed8e76465206e7ca9550de42bc432039edc4e.png" />
</div>
</div>
<section id="preprocessing-of-the-raw-images">
<h2>Preprocessing of the Raw Images<a class="headerlink" href="#preprocessing-of-the-raw-images" title="Link to this heading">#</a></h2>
<p>Preprocessing of the raw images is the first step in the data reduction process. The raw images are usually not ready for scientific analysis and need to be preprocessed before they can be used for scientific analysis. The preprocessing steps include the following:</p>
<ol class="arabic simple">
<li><p>Bias subtraction</p></li>
<li><p>Dark subtraction</p></li>
<li><p>Flat fielding</p></li>
<li><p>Cosmic ray removal</p></li>
</ol>
<p>There are lots of software available for preprocessing the raw images. In this tutorial, we will use the <code class="docutils literal notranslate"><span class="pre">ccdproc</span></code> package for preprocessing the raw images. The <code class="docutils literal notranslate"><span class="pre">ccdproc</span></code> package is a Python package for reducing astronomical data taken with CCD cameras. It provides many of the necessary tools for processing of CCD images. For more information on the <code class="docutils literal notranslate"><span class="pre">ccdproc</span></code> package, please visit the <a class="reference external" href="https://ccdproc.readthedocs.io/en/latest/">documentation</a>, and for the complete guide on the reduction process for astronomical images using Python, <a class="reference external" href="https://www.astropy.org/ccd-reduction-and-photometry-guide/v/dev/notebooks/00-00-Preface.html">CCD Reduction and Photometry Guide</a>.</p>
<p>In this notebook, we will preprocess the raw images using <code class="docutils literal notranslate"><span class="pre">preproc.py</span></code> script. This script is available in the tutorial directory. Dark subtraction will not be performed in this notebook since the amount of dark current in the images is negligible.</p>
<section id="making-the-master-bias">
<h3>Making the Master Bias<a class="headerlink" href="#making-the-master-bias" title="Link to this heading">#</a></h3>
<p>Before making the master bias, we need to check the bias images for any defects. We skip this step here, but it is important to check since the bias images are used to calibrate all the other images. If there are defects in the bias images, they will be propagated to all the other images.</p>
<p>The master bias is made by combining all the bias images. The master bias will be subtracted from all the images to remove the bias level. For combining the bias images, the sigma-clipping algorithm is used to reject outliers and then the average of the remaining images is calculated.</p>
<div class="cell tag_hide-output tag_scroll-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">biaslist</span> <span class="o">=</span> <span class="p">[</span><span class="n">RAWDIR</span> <span class="o">/</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">biastab</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]]</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">preproc</span><span class="o">.</span><span class="n">combine_bias</span><span class="p">(</span><span class="n">biaslist</span><span class="p">,</span> <span class="n">outdir</span><span class="o">=</span><span class="n">OUTDIR</span><span class="p">,</span> <span class="n">outname</span><span class="o">=</span><span class="s1">&#39;MBias.fits&#39;</span><span class="p">)</span>
<span class="k">del</span> <span class="n">_</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: FITSFixedWarning: PC001001= 1.00000000 / Pixel Coordinate translation matrix 
this form of the PCi_ja keyword is deprecated, use PCi_ja. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: PC001002= 0.00000000 / Pixel Coordinate translation matrix 
this form of the PCi_ja keyword is deprecated, use PCi_ja. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: PC002001= 0.00000000 / Pixel Coordinate translation matrix 
this form of the PCi_ja keyword is deprecated, use PCi_ja. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: PC002002= 1.00000000 / Pixel Coordinate translation matrix 
this form of the PCi_ja keyword is deprecated, use PCi_ja. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: RADECSYS= &#39;FK5 &#39; / The equatorial coordinate system 
the RADECSYS keyword is deprecated, use RADESYSa. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56450.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-07T04:59:10.645&#39; from MJD-END&#39;. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;unitfix&#39; made the change &#39;Changed units:
  &#39;degree&#39; -&gt; &#39;deg&#39;. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;celfix&#39; made the change &#39;Unmatched celestial axes&#39;. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56449.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-06T14:53:03.880&#39; from MJD-END&#39;. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56449.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-06T04:56:58.652&#39; from MJD-END&#39;. [astropy.wcs.wcs]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56450.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-07T04:59:35.780&#39; from MJD-END&#39;. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56450.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-07T15:06:35.545&#39; from MJD-END&#39;. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56450.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-07T05:00:00.751&#39; from MJD-END&#39;. [astropy.wcs.wcs]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56449.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-06T04:56:34.054&#39; from MJD-END&#39;. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56450.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-07T15:07:00.686&#39; from MJD-END&#39;. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56450.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-07T15:07:53.456&#39; from MJD-END&#39;. [astropy.wcs.wcs]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56449.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-06T04:56:09.042&#39; from MJD-END&#39;. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56449.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-06T14:53:29.035&#39; from MJD-END&#39;. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56450.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-07T15:06:10.558&#39; from MJD-END&#39;. [astropy.wcs.wcs]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56449.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-06T04:55:19.314&#39; from MJD-END&#39;. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56450.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-07T04:58:45.726&#39; from MJD-END&#39;. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56449.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-06T14:52:38.925&#39; from MJD-END&#39;. [astropy.wcs.wcs]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56450.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-07T15:07:26.756&#39; from MJD-END&#39;. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56449.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-06T14:52:13.481&#39; from MJD-END&#39;. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56450.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-07T05:00:25.744&#39; from MJD-END&#39;. [astropy.wcs.wcs]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56449.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-06T04:55:43.954&#39; from MJD-END&#39;. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56449.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-06T14:51:48.267&#39; from MJD-END&#39;. [astropy.wcs.wcs]
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mbias</span> <span class="o">=</span> <span class="n">OUTDIR</span> <span class="o">/</span> <span class="s1">&#39;MBias.fits&#39;</span>
<span class="n">mbias_img</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">mbias</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">interval</span><span class="o">.</span><span class="n">get_limits</span><span class="p">(</span><span class="n">mbias_img</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mbias_img</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Master Bias&#39;</span><span class="p">)</span>
<span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;5%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x16fec0d50&gt;
</pre></div>
</div>
<img alt="../_images/9f46beaf25df9ec57c69ae77eb83e18b24672b2deb632d7f1ae3f2dbdbd4020d.png" class="align-center" src="../_images/9f46beaf25df9ec57c69ae77eb83e18b24672b2deb632d7f1ae3f2dbdbd4020d.png" />
</div>
</div>
</section>
<section id="making-master-flat">
<h3>Making Master Flat<a class="headerlink" href="#making-master-flat" title="Link to this heading">#</a></h3>
<p>Not like the photometric observation, spectroscopic flat image is typically taken with something like halogen lamp or tungsten lamp, which is inevitably not uniform especially for the dispersion direction. Therefore, we need to make a master flat image <em>flat</em>, which involves modeling the flat spectrum and dividing the flat image by the model. To obtain a good master flat, we need to:</p>
<ol class="arabic simple">
<li><p><strong>Examine the flat spectra</strong>: do they show any variablity throughout the observation? can we combine them without any further consideration? do they have any features like wiggles or bumps? do they have any discontinuity?</p></li>
<li><p><strong>Model the flat spectra</strong>: we can use a polynomial (or smoothing convolution) to model the flat spectrum. The degree of the polynomial (or size of the smoothing kernel) should be determined by the complexity of the flat spectrum.</p></li>
<li><p><strong>Normalize the flat spectra</strong>: divide the flat image by the model to obtain a normalized flat image.</p></li>
</ol>
<p>Combining can be done either before or after the modeling. If the flat spectra are stable, we can combine them first and then model the combined flat spectrum. If the flat spectra are not stable, we can model each flat spectrum and then combine the normalized flat images. If the flat spectra show significant variability, we can also consider not combining them at all.</p>
<p>Because of this complexity, making a master flat can be a time-consuming part of the data reduction process. Moreover, the quality of the master flat directly affects the quality of the reduced science images, which may introduce systematic errors if not done properly. Therefore, the spectroscopic flat fielding is often omitted in the data reduction process, when the flat fielding conversely introduces more errors than it corrects.</p>
<section id="checking-for-flat-image-shift">
<h4>Checking for Flat Image Shift<a class="headerlink" href="#checking-for-flat-image-shift" title="Link to this heading">#</a></h4>
<p>The flat image may shift slightly depending on the telescope’s pointing direction. Since different images might require different flats, it can be risky to median combine all the flat images taken overnight. We should perform a quick and rough check to see if there is a shift in the flat images.</p>
<p>To avoid bias might arise from this shift, it is recommended to take flat images at the same pointing direction as the science images. However, if the shift is small, we can still use the median combined flat image for calibration.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>With the same reason, we should be careful when we reduce the arc frames. The location of the lines in the arc spectrum may shift slightly depending on the telescope’s pointing direction. Therefore, it is strongly recommended to take arc frames at the same pointing direction as the science frames.</p>
<p>We should check for the shift in the arc frames, but we will skip this process for simplicity.</p>
<p>However, unlike the flat fielding, the wavelength calibration is of critical importance in the spectroscopic data reduction process, since few percent of errors in the wavelength calibration can introduce systematic errors in the scientific analysis, such as the measurement of the redshift of galaxies. Therefore, we should always check for the shift in the arc frames before wavelength calibration.</p>
</div>
<p>In this notebook, we will skip this process for simplicity, but you should always check for flat image shift in your own data. We will assume that the flat images are already aligned, and we will proceed to combine them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flattab_exp3</span> <span class="o">=</span> <span class="n">flattab</span><span class="p">[</span><span class="n">flattab</span><span class="p">[</span><span class="s1">&#39;exptime&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">3.0</span><span class="p">]</span>
<span class="n">flattab_exp1</span> <span class="o">=</span> <span class="n">flattab</span><span class="p">[</span><span class="n">flattab</span><span class="p">[</span><span class="s1">&#39;exptime&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.1</span><span class="p">]</span>
<span class="n">flatlist_exp3</span> <span class="o">=</span> <span class="p">[</span><span class="n">RAWDIR</span> <span class="o">/</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">flattab_exp3</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]]</span>
<span class="n">flatlist_exp1</span> <span class="o">=</span> <span class="p">[</span><span class="n">RAWDIR</span> <span class="o">/</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">flattab_exp1</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]]</span>

<span class="n">mbias</span> <span class="o">=</span> <span class="n">OUTDIR</span> <span class="o">/</span> <span class="s1">&#39;MBias.fits&#39;</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">preproc</span><span class="o">.</span><span class="n">make_master_flat</span><span class="p">(</span><span class="n">flatlist_exp3</span><span class="p">,</span> <span class="n">outdir</span><span class="o">=</span><span class="n">OUTDIR</span><span class="p">,</span> <span class="n">outname</span><span class="o">=</span><span class="s1">&#39;MFlat03.0.fits&#39;</span><span class="p">,</span> 
                             <span class="n">mbias</span><span class="o">=</span><span class="n">mbias</span><span class="p">,</span> <span class="n">filter_key</span><span class="o">=</span><span class="s1">&#39;FILTER02&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">preproc</span><span class="o">.</span><span class="n">make_master_flat</span><span class="p">(</span><span class="n">flatlist_exp1</span><span class="p">,</span> <span class="n">outdir</span><span class="o">=</span><span class="n">OUTDIR</span><span class="p">,</span> <span class="n">outname</span><span class="o">=</span><span class="s1">&#39;MFlat01.1.fits&#39;</span><span class="p">,</span>
                             <span class="n">mbias</span><span class="o">=</span><span class="n">mbias</span><span class="p">,</span> <span class="n">filter_key</span><span class="o">=</span><span class="s1">&#39;FILTER02&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">del</span> <span class="n">_</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="comparing-with-the-standard-star-profile">
<h4>Comparing with the Standard Star Profile<a class="headerlink" href="#comparing-with-the-standard-star-profile" title="Link to this heading">#</a></h4>
<p>Typical flat spectra shows many wiggles and bumps. Yet, we don’t know if these features are originated from the grating (as a representation of common instruments that can affect the both flat and science frames), which in turn will affect our science frame equally. If they are not due to the grating, such as filters in front of the flat-field lamp, the extreme difference in color temperature between the lamps and the object of interest, or wavelength-dependent variations in the reflectivity of the paint used for the flat-field screen (<a class="reference external" href="https://arxiv.org/abs/1010.5270">Massey &amp; Hansen, 2010</a>), they are not going to present on the science frame.</p>
<p>Let’s see if a supposedly smooth source (in this case, a standard star) has same “wiggles” and “bumps” on its spectrum. If this is the case, we should normalize the flat spectrum with a constant value (or a “low-order” functional model). If not, we should adopt “high-order” model or constant to normalize our flat field. For more information, please refer to <a class="reference external" href="https://arxiv.org/abs/1010.5270">Section 3.1., Massey &amp; Hansen (2010)</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">flat03</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">OUTDIR</span> <span class="o">/</span> <span class="s1">&#39;MFlat03.0.fits&#39;</span><span class="p">)</span>
<span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">interval</span><span class="o">.</span><span class="n">get_limits</span><span class="p">(</span><span class="n">flat03</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">flat03</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Master Flat (3.0s)&#39;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">flat01</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">OUTDIR</span> <span class="o">/</span> <span class="s1">&#39;MFlat01.1.fits&#39;</span><span class="p">)</span>
<span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">interval</span><span class="o">.</span><span class="n">get_limits</span><span class="p">(</span><span class="n">flat01</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">flat03</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Master Flat (1.1s)&#39;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">f34</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">RAWDIR</span> <span class="o">/</span> <span class="n">stdtab_f34</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">interval</span><span class="o">.</span><span class="n">get_limits</span><span class="p">(</span><span class="n">f34</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f34</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Feige34 (Standard Star)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Feige34 (Standard Star)&#39;)
</pre></div>
</div>
<img alt="../_images/0d9489f6864161c7cab87eec30fdce2bf45f9450a6cbd3f7856cca2fb84d7c18.png" class="align-center" src="../_images/0d9489f6864161c7cab87eec30fdce2bf45f9450a6cbd3f7856cca2fb84d7c18.png" />
<img alt="../_images/7b79e4ede2ad792a301bfc9a930aebbb033c6472aaf8e29bc14c7203ab20c86c.png" class="align-center" src="../_images/7b79e4ede2ad792a301bfc9a930aebbb033c6472aaf8e29bc14c7203ab20c86c.png" />
<img alt="../_images/b06bf9ae6cca6024c34aa258decf6bc9add0e98656c2e79e44019bb0803300f6.png" class="align-center" src="../_images/b06bf9ae6cca6024c34aa258decf6bc9add0e98656c2e79e44019bb0803300f6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">flat03</span><span class="p">[:,</span> <span class="mi">700</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="s1">&#39;Master Flat, 3.0s, Row 700&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f34</span><span class="p">[:,</span> <span class="mi">737</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="s1">&#39;Feige34, Row 700, Raw&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8f6ce0de6fc34a475c3ee540b4409adeea25240f63111cda4cfffd60fed6639f.png" class="align-center" src="../_images/8f6ce0de6fc34a475c3ee540b4409adeea25240f63111cda4cfffd60fed6639f.png" />
</div>
</div>
<p>Although we can see some tiny wiggles in the flat spectrum, this is not significant enough to adopt higher-order polynomials to model the flat spectrum, as opposed to the case if we have significant fringe patterns. If you closely examine the flat spectrum, you will see that the wiggles are not random, but rather located at the atmospheric absorption lines. This is because the flat image is taken with a lamp, and the lamp light is absorbed by the atmosphere at these absorption lines. Since the absorption lines are not random, we can safely ignore them when modeling the flat spectrum.</p>
<p>Here we model the flat spectrum with median filtering, which is a simple and effective way to remove noise while preserving the shape of the spectrum. We will use a median filter in the dispersion direction to model the flat spectrum, with a window size of 100 pixels. This is a good starting point, but you may need to adjust the window size depending on the complexity of the flat spectrum.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although I compared the horizontal profile of the standard star and the flat image for convenience, it might as well natural to compare the final extracted spectra of the standard star after applying both the high-order and low-order model of the flat field.</p>
</div>
<p>For simplicity, we will only use the combined flat image taken with the exposure time of 3 seconds. In practice, you may use all the flat images taken with different exposure times to make a master flat, or you can use the flat images taken with long and short exposure times to make a bad pixel map.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># median filtering the flat field image along the dispersion axis</span>
<span class="n">flat03_filt</span> <span class="o">=</span> <span class="n">median_filter</span><span class="p">(</span><span class="n">flat03</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># normalizing the flat field image</span>
<span class="n">normflat</span> <span class="o">=</span> <span class="n">flat03</span> <span class="o">/</span> <span class="n">flat03_filt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">flat03</span><span class="p">[:,</span> <span class="mi">700</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Raw&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">flat03_filt</span><span class="p">[:,</span> <span class="mi">700</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Filtered&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">4100</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">normflat</span><span class="p">[:,</span> <span class="mi">700</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Normalized&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">4100</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">311</span><span class="p">)</span>
<span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">interval</span><span class="o">.</span><span class="n">get_limits</span><span class="p">(</span><span class="n">flat03</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">flat03</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Master Flat&#39;</span><span class="p">)</span>
<span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;2%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">312</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">flat03_filt</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Filtered Master Flat&#39;</span><span class="p">)</span>
<span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;2%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">313</span><span class="p">)</span>
<span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">interval</span><span class="o">.</span><span class="n">get_limits</span><span class="p">(</span><span class="n">normflat</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">normflat</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Normalized Master Flat&#39;</span><span class="p">)</span>
<span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;2%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x16ffc8d50&gt;
</pre></div>
</div>
<img alt="../_images/e419a45987536ab789deff391e609e1e5aa775d8ba57ca55f0b1853ac680bbed.png" class="align-center" src="../_images/e419a45987536ab789deff391e609e1e5aa775d8ba57ca55f0b1853ac680bbed.png" />
<img alt="../_images/9cc5a21c501eb8e2eecbb89af4fa76b3ec881d8e3ad7ad132115638d1802f96e.png" class="align-center" src="../_images/9cc5a21c501eb8e2eecbb89af4fa76b3ec881d8e3ad7ad132115638d1802f96e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># writing the normalized flat field image to a file</span>
<span class="n">hdr</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">OUTDIR</span> <span class="o">/</span> <span class="s1">&#39;MFlat03.0.fits&#39;</span><span class="p">)</span>
<span class="n">hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">normflat</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">hdr</span><span class="p">)</span>
<span class="n">hdu</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">OUTDIR</span> <span class="o">/</span> <span class="s1">&#39;nMFlat03.0.fits&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="preprocessing-the-raw-images">
<h3>Preprocessing the Raw Images<a class="headerlink" href="#preprocessing-the-raw-images" title="Link to this heading">#</a></h3>
<p>Now we will preprocess the raw images. We will subtract the master bias and divide the master flat from the raw science frames. These preprocessed science frames will not be combined, since the spatial location of the object is different in each frame. We will combine the light from the object after extracting the 1D spectrum.</p>
<div class="cell tag_scroll-output tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mbias</span> <span class="o">=</span> <span class="n">OUTDIR</span> <span class="o">/</span> <span class="s1">&#39;MBias.fits&#39;</span>
<span class="n">mflat</span> <span class="o">=</span> <span class="n">OUTDIR</span> <span class="o">/</span> <span class="s1">&#39;nMFlat03.0.fits&#39;</span>
<span class="c1"># preprocessing the arc image</span>
<span class="n">arc_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">RAWDIR</span> <span class="o">/</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">arctab</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Preprocessing arc images...&#39;</span><span class="p">)</span>
<span class="n">arc</span> <span class="o">=</span> <span class="n">preproc</span><span class="o">.</span><span class="n">preproc</span><span class="p">(</span><span class="n">arc_list</span><span class="p">,</span> <span class="n">mbias</span><span class="o">=</span><span class="n">mbias</span><span class="p">,</span> <span class="n">mflat</span><span class="o">=</span><span class="n">mflat</span><span class="p">,</span> <span class="n">outdir</span><span class="o">=</span><span class="n">OUTDIR</span><span class="p">)</span>

<span class="c1"># combine the preprocessed arc image</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Combining the preprocessed arc images...&#39;</span><span class="p">)</span>
<span class="n">parcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">OUTDIR</span> <span class="o">/</span> <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="o">+</span><span class="n">f</span><span class="o">.</span><span class="n">stem</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">arc_list</span><span class="p">]</span>
<span class="n">carc</span> <span class="o">=</span> <span class="n">combine</span><span class="p">(</span><span class="n">parcs</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="n">sigma_clip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sigma_clip_low_thresh</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
               <span class="n">sigma_clip_high_thresh</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">carc</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">OUTDIR</span> <span class="o">/</span> <span class="s1">&#39;cArc.fits&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The combined arc image is saved as cArc.fits&#39;</span><span class="p">)</span>

<span class="c1"># preprocessing the science image</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Preprocessing science images...&#39;</span><span class="p">)</span>
<span class="n">sci_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">RAWDIR</span> <span class="o">/</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">scitab</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]]</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">preproc</span><span class="o">.</span><span class="n">preproc</span><span class="p">(</span><span class="n">sci_list</span><span class="p">,</span> <span class="n">mbias</span><span class="o">=</span><span class="n">mbias</span><span class="p">,</span> <span class="n">mflat</span><span class="o">=</span><span class="n">mflat</span><span class="p">,</span> <span class="n">outdir</span><span class="o">=</span><span class="n">OUTDIR</span><span class="p">,</span> <span class="n">insert_ivar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># preprocessing the standard star images</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Preprocessing standard star images...&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Standard star: Feige110&#39;</span><span class="p">)</span>
<span class="n">std_list_f110</span> <span class="o">=</span> <span class="p">[</span><span class="n">RAWDIR</span> <span class="o">/</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">stdtab_f110</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]]</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">preproc</span><span class="o">.</span><span class="n">preproc</span><span class="p">(</span><span class="n">std_list_f110</span><span class="p">,</span> <span class="n">mbias</span><span class="o">=</span><span class="n">mbias</span><span class="p">,</span> <span class="n">mflat</span><span class="o">=</span><span class="n">mflat</span><span class="p">,</span> <span class="n">outdir</span><span class="o">=</span><span class="n">OUTDIR</span><span class="p">,</span>
                    <span class="n">insert_ivar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Standard star: Feige34&#39;</span><span class="p">)</span>
<span class="n">std_list_f34</span> <span class="o">=</span> <span class="p">[</span><span class="n">RAWDIR</span> <span class="o">/</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">stdtab_f34</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]]</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">preproc</span><span class="o">.</span><span class="n">preproc</span><span class="p">(</span><span class="n">std_list_f34</span><span class="p">,</span> <span class="n">mbias</span><span class="o">=</span><span class="n">mbias</span><span class="p">,</span> <span class="n">mflat</span><span class="o">=</span><span class="n">mflat</span><span class="p">,</span> <span class="n">outdir</span><span class="o">=</span><span class="n">OUTDIR</span><span class="p">,</span>
                    <span class="n">insert_ivar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Preprocessing arc images...
Done: pFCSA00141840.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/hbahk/class/TAOtutorials/tutorials/preproc.py:295: RuntimeWarning: invalid value encountered in divide
  sci_data /= mflat_data    # Flat fielding
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done: pFCSA00141882.fits
Done: pFCSA00141580.fits
Combining the preprocessed arc images...
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: FITSFixedWarning: PC001001= 1.00000000 / Pixel Coordinate translation matrix 
this form of the PCi_ja keyword is deprecated, use PCi_ja. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: PC001002= 0.00000000 / Pixel Coordinate translation matrix 
this form of the PCi_ja keyword is deprecated, use PCi_ja. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: PC002001= 0.00000000 / Pixel Coordinate translation matrix 
this form of the PCi_ja keyword is deprecated, use PCi_ja. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: PC002002= 1.00000000 / Pixel Coordinate translation matrix 
this form of the PCi_ja keyword is deprecated, use PCi_ja. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: RADECSYS= &#39;FK5 &#39; / The equatorial coordinate system 
the RADECSYS keyword is deprecated, use RADESYSa. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56450.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-07T04:55:27.734&#39; from MJD-END&#39;. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;unitfix&#39; made the change &#39;Changed units:
  &#39;degree&#39; -&gt; &#39;deg&#39;. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;celfix&#39; made the change &#39;Unmatched celestial axes&#39;. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56450.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-07T05:51:12.249&#39; from MJD-END&#39;. [astropy.wcs.wcs]
WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 56449.000000 from DATE-OBS.
Set DATE-END to &#39;2013-06-06T04:52:48.140&#39; from MJD-END&#39;. [astropy.wcs.wcs]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: An exception happened while extracting WCS information from the Header.
InconsistentAxisTypesError: ERROR 4 in wcs_types() at line 3140 of file cextern/wcslib/C/wcs.c:
Unmatched celestial axes.
 [astropy.nddata.ccddata]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/anaconda3/envs/main/lib/python3.11/site-packages/ccdproc/combiner.py:548: RuntimeWarning: Mean of empty slice
  mean = scale_func(data, axis=0)
/opt/anaconda3/envs/main/lib/python3.11/site-packages/numpy/lib/nanfunctions.py:1879: RuntimeWarning: Degrees of freedom &lt;= 0 for slice.
  var = nanvar(a, axis=axis, dtype=dtype, out=out, ddof=ddof,
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The combined arc image is saved as cArc.fits
Preprocessing science images...
Done: pFCSA00141920.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/hbahk/class/TAOtutorials/tutorials/preproc.py:295: RuntimeWarning: invalid value encountered in divide
  sci_data /= mflat_data    # Flat fielding
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done: pFCSA00141930.fits
Done: pFCSA00141916.fits
Done: pFCSA00141928.fits
Done: pFCSA00141938.fits
Done: pFCSA00141940.fits
Done: pFCSA00141918.fits
Done: pFCSA00141936.fits
Done: pFCSA00141926.fits
Preprocessing standard star images...
Standard star: Feige110
Done: pFCSA00142004.fits
Done: pFCSA00142006.fits
Done: pFCSA00142010.fits
Standard star: Feige34
Done: pFCSA00141880.fits
Done: pFCSA00141894.fits
Done: pFCSA00141878.fits
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">interval</span><span class="o">.</span><span class="n">get_limits</span><span class="p">(</span><span class="n">carc</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">carc</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Combined Image&#39;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">sci</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">OUTDIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;p</span><span class="si">{</span><span class="n">sci_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">interval</span><span class="o">.</span><span class="n">get_limits</span><span class="p">(</span><span class="n">sci</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sci</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Preprocessed Science Image&#39;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">std110</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">OUTDIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;p</span><span class="si">{</span><span class="n">std_list_f110</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">interval</span><span class="o">.</span><span class="n">get_limits</span><span class="p">(</span><span class="n">std110</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">std110</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Preprocessed Feige110 Image&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Preprocessed Feige110 Image&#39;)
</pre></div>
</div>
<img alt="../_images/54102e9aec5b969dbd9ac26e49ba748d5ef12ef5ec236657921e1f0a509ea43e.png" class="align-center" src="../_images/54102e9aec5b969dbd9ac26e49ba748d5ef12ef5ec236657921e1f0a509ea43e.png" />
<img alt="../_images/25c812e0f10109564e95dfca392cc078ed1ed29ab3bd3135ba3d2a6342f0a4f0.png" class="align-center" src="../_images/25c812e0f10109564e95dfca392cc078ed1ed29ab3bd3135ba3d2a6342f0a4f0.png" />
<img alt="../_images/810447622afd39c50bb8122d59b9f8db5ef73554c9898cbfd93d6de46f406b61.png" class="align-center" src="../_images/810447622afd39c50bb8122d59b9f8db5ef73554c9898cbfd93d6de46f406b61.png" />
</div>
</div>
</section>
</section>
<section id="extracting-1d-spectra">
<h2>Extracting 1D Spectra<a class="headerlink" href="#extracting-1d-spectra" title="Link to this heading">#</a></h2>
<p>The 1D spectra are extracted from the 2D science frames by summing the flux along the spatial direction. The extraction process consists of the following steps:</p>
<ol class="arabic simple">
<li><p><strong>Source Identification</strong>: Identify the source in the 2D science frame.</p></li>
<li><p><strong>Aperture Tracing</strong>: Trace the spatial position of the source along the dispersion direction.</p></li>
<li><p><strong>Aperture Summation</strong>: Sum the flux along the trace to extract the 1D spectrum.</p></li>
</ol>
<p>Let’s extract the 1D spectra of the standard star first, because it is brighter and easier to extract.</p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="GALFIT-Surface_Photometry.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Surface Photometry Using GALFIT</p>
      </div>
    </a>
    <a class="right-next"
       href="Proj5_Spectroscopic_Data_Analysis.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Project 5: Spectroscopic Data Analysis</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-of-the-raw-images">Preprocessing of the Raw Images</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#making-the-master-bias">Making the Master Bias</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#making-master-flat">Making Master Flat</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-for-flat-image-shift">Checking for Flat Image Shift</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-with-the-standard-star-profile">Comparing with the Standard Star Profile</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-the-raw-images">Preprocessing the Raw Images</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-1d-spectra">Extracting 1D Spectra</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Hyeonguk Bahk
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, Hyeonguk Bahk.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>